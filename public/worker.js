/** @webqit/webflo */(async () => {
var Xr=Object.defineProperty;var Zr=(e,t)=>()=>(e&&(t=e(e=0)),t);var Kr=(e,t)=>{for(var r in t)Xr(e,r,{get:t[r],enumerable:!0})};var dr={};Kr(dr,{URLPattern:()=>hr});function pn(e,t){return(t?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(e)}function tr(e,t=!1){let r=[],n=0;for(;n<e.length;){let i=e[n],o=function(s){if(!t)throw new TypeError(s);r.push({type:"INVALID_CHAR",index:n,value:e[n++]})};if(i==="*"){r.push({type:"ASTERISK",index:n,value:e[n++]});continue}if(i==="+"||i==="?"){r.push({type:"MODIFIER",index:n,value:e[n++]});continue}if(i==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});continue}if(i==="{"){r.push({type:"OPEN",index:n,value:e[n++]});continue}if(i==="}"){r.push({type:"CLOSE",index:n,value:e[n++]});continue}if(i===":"){let s="",f=n+1;for(;f<e.length;){let a=e.substr(f,1);if(f===n+1&&cn.test(a)||f!==n+1&&mn.test(a)){s+=e[f++];continue}break}if(!s){o(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:s}),n=f;continue}if(i==="("){let s=1,f="",a=n+1,u=!1;if(e[a]==="?"){o(`Pattern cannot start with "?" at ${a}`);continue}for(;a<e.length;){if(!pn(e[a],!1)){o(`Invalid character '${e[a]}' at ${a}.`),u=!0;break}if(e[a]==="\\"){f+=e[a++]+e[a++];continue}if(e[a]===")"){if(s--,s===0){a++;break}}else if(e[a]==="("&&(s++,e[a+1]!=="?")){o(`Capturing groups are not allowed at ${a}`),u=!0;break}f+=e[a++]}if(u)continue;if(s){o(`Unbalanced pattern at ${n}`);continue}if(!f){o(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:f}),n=a;continue}r.push({type:"CHAR",index:n,value:e[n++]})}return r.push({type:"END",index:n,value:""}),r}function rr(e,t={}){let r=tr(e),{prefixes:n="./"}=t,i=`[^${we(t.delimiter||"/#?")}]+?`,o=[],s=0,f=0,a="",u=new Set,l=y=>{if(f<r.length&&r[f].type===y)return r[f++].value},c=()=>{let y=l("MODIFIER");return y||l("ASTERISK")},m=y=>{let C=l(y);if(C!==void 0)return C;let{type:E,index:j}=r[f];throw new TypeError(`Unexpected ${E} at ${j}, expected ${y}`)},p=()=>{let y="",C;for(;C=l("CHAR")||l("ESCAPED_CHAR");)y+=C;return y},N=y=>y,T=t.encodePart||N;for(;f<r.length;){let y=l("CHAR"),C=l("NAME"),E=l("PATTERN");if(!C&&!E&&l("ASTERISK")&&(E=".*"),C||E){let v=y||"";n.indexOf(v)===-1&&(a+=v,v=""),a&&(o.push(T(a)),a="");let k=C||s++;if(u.has(k))throw new TypeError(`Duplicate name '${k}'.`);u.add(k),o.push({name:k,prefix:T(v),suffix:"",pattern:E||i,modifier:c()||""});continue}let j=y||l("ESCAPED_CHAR");if(j){a+=j;continue}if(l("OPEN")){let v=p(),k=l("NAME")||"",H=l("PATTERN")||"";!k&&!H&&l("ASTERISK")&&(H=".*");let ze=p();m("CLOSE");let Bt=c()||"";if(!k&&!H&&!Bt){a+=v;continue}if(!k&&!H&&!v)continue;a&&(o.push(T(a)),a=""),o.push({name:k||(H?s++:""),pattern:k&&!H?i:H,prefix:T(v),suffix:T(ze),modifier:Bt});continue}a&&(o.push(T(a)),a=""),m("END")}return o}function we(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function nr(e){return e&&e.sensitive?"u":"ui"}function hn(e,t){if(!t)return e;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(e.source);for(;i;)t.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(e.source);return e}function dn(e,t,r){let n=e.map(i=>or(i,t,r).source);return new RegExp(`(?:${n.join("|")})`,nr(r))}function gn(e,t,r){return ir(rr(e,r),t,r)}function ir(e,t,r={}){let{strict:n=!1,start:i=!0,end:o=!0,encode:s=l=>l}=r,f=`[${we(r.endsWith||"")}]|$`,a=`[${we(r.delimiter||"/#?")}]`,u=i?"^":"";for(let l of e)if(typeof l=="string")u+=we(s(l));else{let c=we(s(l.prefix)),m=we(s(l.suffix));if(l.pattern)if(t&&t.push(l),c||m)if(l.modifier==="+"||l.modifier==="*"){let p=l.modifier==="*"?"?":"";u+=`(?:${c}((?:${l.pattern})(?:${m}${c}(?:${l.pattern}))*)${m})${p}`}else u+=`(?:${c}(${l.pattern})${m})${l.modifier}`;else l.modifier==="+"||l.modifier==="*"?u+=`((?:${l.pattern})${l.modifier})`:u+=`(${l.pattern})${l.modifier}`;else u+=`(?:${c}${m})${l.modifier}`}if(o)n||(u+=`${a}?`),u+=r.endsWith?`(?=${f})`:"$";else{let l=e[e.length-1],c=typeof l=="string"?a.indexOf(l[l.length-1])>-1:l===void 0;n||(u+=`(?:${a}(?=${f}))?`),c||(u+=`(?=${a}|${f})`)}return new RegExp(u,nr(r))}function or(e,t,r){return e instanceof RegExp?hn(e,t):Array.isArray(e)?dn(e,t,r):gn(e,t,r)}function yn(e,t){return e.length?e[0]==="/"?!0:!t||e.length<2?!1:(e[0]=="\\"||e[0]=="{")&&e[1]=="/":!1}function sr(e,t){return e.startsWith(t)?e.substring(t.length,e.length):e}function wn(e,t){return e.endsWith(t)?e.substr(0,e.length-t.length):e}function fr(e){return!e||e.length<2?!1:e[0]==="["||(e[0]==="\\"||e[0]==="{")&&e[1]==="["}function ur(e){if(!e)return!0;for(let t of ar)if(e.test(t))return!0;return!1}function bn(e,t){if(e=sr(e,"#"),t||e==="")return e;let r=new URL("https://example.com");return r.hash=e,r.hash?r.hash.substring(1,r.hash.length):""}function vn(e,t){if(e=sr(e,"?"),t||e==="")return e;let r=new URL("https://example.com");return r.search=e,r.search?r.search.substring(1,r.search.length):""}function On(e,t){return t||e===""?e:fr(e)?mr(e):cr(e)}function Sn(e,t){if(t||e==="")return e;let r=new URL("https://example.com");return r.password=e,r.password}function Pn(e,t){if(t||e==="")return e;let r=new URL("https://example.com");return r.username=e,r.username}function En(e,t,r){if(r||e==="")return e;if(t&&!ar.includes(t))return new URL(`${t}:${e}`).pathname;let n=e[0]=="/";return e=new URL(n?e:"/-"+e,"https://example.com").pathname,n||(e=e.substring(2,e.length)),e}function An(e,t,r){return lr(t)===e&&(e=""),r||e===""?e:pr(e)}function Cn(e,t){return e=wn(e,":"),t||e===""?e:St(e)}function lr(e){switch(e){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function St(e){if(e==="")return e;if(/^[-+.A-Za-z0-9]*$/.test(e))return e.toLowerCase();throw new TypeError(`Invalid protocol '${e}'.`)}function Tn(e){if(e==="")return e;let t=new URL("https://example.com");return t.username=e,t.username}function Rn(e){if(e==="")return e;let t=new URL("https://example.com");return t.password=e,t.password}function cr(e){if(e==="")return e;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(e))throw new TypeError(`Invalid hostname '${e}'`);let t=new URL("https://example.com");return t.hostname=e,t.hostname}function mr(e){if(e==="")return e;if(/[^0-9a-fA-F[\]:]/g.test(e))throw new TypeError(`Invalid IPv6 hostname '${e}'`);return e.toLowerCase()}function pr(e){if(e===""||/^[0-9]*$/.test(e)&&parseInt(e)<=65535)return e;throw new TypeError(`Invalid port '${e}'.`)}function Fn(e){if(e==="")return e;let t=new URL("https://example.com");return t.pathname=e[0]!=="/"?"/-"+e:e,e[0]!=="/"?t.pathname.substring(2,t.pathname.length):t.pathname}function Ln(e){return e===""?e:new URL(`data:${e}`).pathname}function jn(e){if(e==="")return e;let t=new URL("https://example.com");return t.search=e,t.search.substring(1,t.search.length)}function In(e){if(e==="")return e;let t=new URL("https://example.com");return t.hash=e,t.hash.substring(1,t.hash.length)}function er(e,t){if(typeof e!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(e,t);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function Le(e,t,r){let n;if(typeof t.baseURL=="string")try{n=new URL(t.baseURL),e.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",e.username=n.username,e.password=n.password,e.hostname=n.hostname,e.port=n.port,e.pathname=n.pathname,e.search=n.search?n.search.substring(1,n.search.length):"",e.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${t.baseURL}'.`)}if(typeof t.protocol=="string"&&(e.protocol=Cn(t.protocol,r)),typeof t.username=="string"&&(e.username=Pn(t.username,r)),typeof t.password=="string"&&(e.password=Sn(t.password,r)),typeof t.hostname=="string"&&(e.hostname=On(t.hostname,r)),typeof t.port=="string"&&(e.port=An(t.port,e.protocol,r)),typeof t.pathname=="string"){if(e.pathname=t.pathname,n&&!yn(e.pathname,r)){let i=n.pathname.lastIndexOf("/");i>=0&&(e.pathname=n.pathname.substring(0,i+1)+e.pathname)}e.pathname=En(e.pathname,e.protocol,r)}return typeof t.search=="string"&&(e.search=vn(t.search,r)),typeof t.hash=="string"&&(e.hash=bn(t.hash,r)),e}function je(e){return e.replace(/([+*?:{}()\\])/g,"\\$1")}function $n(e){return e.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Dn(e,t){let r=".*",n=`[^${$n(t.delimiter||"/#?")}]+?`,i=/[$_\u200C\u200D\p{ID_Continue}]/u,o="";for(let s=0;s<e.length;++s){let f=e[s],a=s>0?e[s-1]:null,u=s<e.length-1?e[s+1]:null;if(typeof f=="string"){o+=je(f);continue}if(f.pattern===""){if(f.modifier===""){o+=je(f.prefix);continue}o+=`{${je(f.prefix)}}${f.modifier}`;continue}let l=typeof f.name!="number",c=t.prefixes!==void 0?t.prefixes:"./",m=f.suffix!==""||f.prefix!==""&&(f.prefix.length!==1||!c.includes(f.prefix));if(!m&&l&&f.pattern===n&&f.modifier===""&&u&&!u.prefix&&!u.suffix)if(typeof u=="string"){let p=u.length>0?u[0]:"";m=i.test(p)}else m=typeof u.name=="number";if(!m&&f.prefix===""&&a&&typeof a=="string"&&a.length>0){let p=a[a.length-1];m=c.includes(p)}m&&(o+="{"),o+=je(f.prefix),l&&(o+=`:${f.name}`),f.pattern===r?!l&&(!a||typeof a=="string"||a.modifier||m||f.prefix!=="")?o+="*":o+=`(${r})`:f.pattern===n?l||(o+=`(${n})`):o+=`(${f.pattern})`,f.pattern===n&&l&&f.suffix!==""&&i.test(f.suffix[0])&&(o+="\\"),o+=je(f.suffix),m&&(o+="}"),o+=f.modifier}return o}var cn,mn,Y,_n,xn,ar,Nn,kn,J,hr,gr=Zr(()=>{cn=/[$_\p{ID_Start}]/u,mn=/[$_\u200C\u200D\p{ID_Continue}]/u;Y={delimiter:"",prefixes:"",sensitive:!0,strict:!0},_n={delimiter:".",prefixes:"",sensitive:!0,strict:!0},xn={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};ar=["ftp","file","http","https","ws","wss"];Nn=class{constructor(e){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=e}get result(){return this.internalResult}parse(){for(this.tokenList=tr(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let e=7,t=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(e=2,t=3):this.shouldTreatAsStandardURL&&(e=2),this.changeState(e,t)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(e,t){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(e,t)}changeStateWithoutSettingComponent(e,t){this.state=e,this.componentStart=this.tokenIndex+t,this.tokenIndex+=t,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(e){this.rewind(),this.state=e}safeToken(e){return e<0&&(e=this.tokenList.length-e),e<this.tokenList.length?this.tokenList[e]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(e,t){let r=this.safeToken(e);return r.value===t&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let e=this.safeToken(this.tokenIndex-1);return e.type!=="NAME"&&e.type!=="PATTERN"&&e.type!=="CLOSE"&&e.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let e=this.tokenList[this.tokenIndex],t=this.safeToken(this.componentStart).index;return this.input.substring(t,e.index)}computeShouldTreatAsStandardURL(){let e={};Object.assign(e,Y),e.encodePart=St;let t=or(this.makeComponentString(),void 0,e);this.shouldTreatAsStandardURL=ur(t)}},kn=["protocol","username","password","hostname","port","pathname","search","hash"],J="*";hr=class{constructor(e={},t){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof e=="string"){let i=new Nn(e);if(i.parse(),e=i.result,t)if(typeof t=="string")e.baseURL=t;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof e.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(t)throw new TypeError("parameter 1 is not of type 'string'.");if(!e||typeof e!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:J,protocol:J,username:J,password:J,hostname:J,port:J,search:J,hash:J};this.pattern=Le(r,e,!0),lr(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of kn){if(!(n in this.pattern))continue;let i={},o=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(i,Y),i.encodePart=St;break;case"username":Object.assign(i,Y),i.encodePart=Tn;break;case"password":Object.assign(i,Y),i.encodePart=Rn;break;case"hostname":Object.assign(i,_n),fr(o)?i.encodePart=mr:i.encodePart=cr;break;case"port":Object.assign(i,Y),i.encodePart=pr;break;case"pathname":ur(this.regexp.protocol)?(Object.assign(i,xn),i.encodePart=Fn):(Object.assign(i,Y),i.encodePart=Ln);break;case"search":Object.assign(i,Y),i.encodePart=jn;break;case"hash":Object.assign(i,Y),i.encodePart=In;break}try{let s=rr(o,i);this.regexp[n]=ir(s,this.keys[n],i),this.component_pattern[n]=Dn(s,i)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(e={},t){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return!1;try{typeof e=="object"?r=Le(r,e,!1):r=Le(r,er(e,t),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(e={},t){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof e!="string"&&t)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof e>"u")return;try{typeof e=="object"?r=Le(r,e,!1):r=Le(r,er(e,t),!1)}catch{return null}let n={};t?n.inputs=[e,t]:n.inputs=[e];let i;for(i in this.pattern){let o=this.regexp[i].exec(r[i]);if(!o)return null;let s={};for(let[f,a]of this.keys[i].entries())if(typeof a.name=="string"||typeof a.name=="number"){let u=o[f+1];s[a.name]=u}n[i]={input:r[i]||"",groups:s}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=hr)});var Te=class{constructor(t,r=null){Object.defineProperty(this,"dict",{value:Object.create(t)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...t){return new this(...t)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(t){this.dict.flags=t}get layout(){return this.dict.layout||{}}set layout(t){this.dict.layout=t}get logger(){return this.dict.logger}set logger(t){this.dict.logger=t}};var Re=class extends Te{};var Fe=class extends Re{};function w(e){return!Array.isArray(e)&&typeof e=="object"&&e}function ge(e){return typeof e}function g(e){return Array.isArray(e)}function _e(e){return typeof e=="function"}function Qe(e){return e===null||e===""}function X(e){return arguments.length&&(e===void 0||typeof e>"u")}function $(e){return Array.isArray(e)||typeof e=="object"&&e||_e(e)}function K(e){return Qe(e)||X(e)||e===!1||e===0||$(e)&&!Object.keys(e).length}function R(e){return _e(e)||e&&{}.toString.call(e)==="[object function]"}function fe(e){return e instanceof Number||typeof e=="number"}function D(e){return fe(e)||e!==!0&&e!==!1&&e!==null&&e!==""&&!isNaN(e*1)}function xt(e){return g(e)&&Object.getPrototypeOf(e)===Array.prototype}function Ge(e){return w(e)&&Object.getPrototypeOf(e)===Object.prototype}function U(e){return e instanceof String||typeof e=="string"&&e!==null}function yt(e){return!U(e)&&!X(e.length)}function Z(e,t,r=!1){if(t=="")return e;var n=r?e.lastIndexOf(t):e.indexOf(t);return n===-1?"":e.substr(n+t.length)}function bt(e,t){return Z(e,t,!0)}function ye(e,t,r=!1){if(t=="")return e;var n=r?e.lastIndexOf(t):e.indexOf(t);return n===-1?e:e.substr(0,n)}function ae(e,t){return ye(e,t,!0)}function Ot(e,t){return e.reduce((r,n,i)=>r||t(n,i),!1)}function M(e,t=!0){return g(e)?e:!t&&w(e)?[e]:e!==!1&&e!==0&&K(e)?[]:yt(e)?Array.prototype.slice.call(e):w(e)?Object.values(e):[e]}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(gr(),dr));function _r(e,t,r,n=!1){if(U(t)&&t.endsWith("]")){var i=ae(bt(t,"["),"]")||0;return D(i)&&(i=parseInt(i)),t=ae(t,"[")||0,D(t)&&(t=parseInt(t)),_r(e,t,(o,s)=>{if(!o[s]){if(!n)return r();o[s]=D(i)?[]:{}}return r(o[s],i)},n)}else return r(e,t)}function Ve(e,t,r,n=!0){_r(e,t,(i,o)=>{D(o)?(o=o||g(i)?i.length:Object.keys(i).filter(D).length,M(r,!1).forEach((s,f)=>{i[o+f]=s})):i[o]=n&&o in i?M(i[o],!1).concat(r):r},!0)}function ue(e,t={},r="&"){return e=e||"",(e.startsWith("?")?e.substr(1):e).split(r).filter(n=>n).map(n=>n.split("=").map(i=>i.trim())).forEach(n=>Ve(t,n[0],decodeURIComponent(n[1]))),t}function Xe(e,t,r,n=null){if((w(t)||g(t))&&(!n||n(t,e))){var i=g(t);Object.keys(t).forEach(o=>{Xe(`${e}[${o}]`,t[o],r,n)})}else r(e,!t&&t!==0?"":t)}function be(e,t="&",r=null){var n=[];return Object.keys(e).forEach(i=>{Xe(i,e[i],(o,s)=>{n.push(`${o}=${encodeURIComponent(s)}`)},r)}),n.join(t)}var xr={join(){for(var e=[],t=0,r=0,n=arguments.length;r<n;r++)e=e.concat(arguments[r].split("/"));var i=[];for(r=0,n=e.length;r<n;r++){var o=e[r];!o||o==="."||(o===".."?i.length?i.pop():t++:i.push(o))}return e[0]===""&&i.unshift(""),"../".repeat(t)+i.join("/")||(i.length?"/":".")},dirname(e){return this.join(e,"..")}},Pt=(e,t=null)=>({pattern:new URLPattern(e,t),isPattern(){return Object.keys(this.pattern.keys||{}).some(r=>this.pattern.keys[r].length)},test(...r){return this.pattern.test(...r)},exec(...r){let n=this.pattern.exec(...r);if(!!n)return n.vars=Object.keys(this.pattern.keys).reduce(({named:i,unnamed:o},s)=>(this.pattern.keys[s].forEach(f=>{let a=n[s].groups[f.name];typeof f.name=="number"?o.push(a):i[f.name]=a}),{named:i,unnamed:o}),{named:{},unnamed:[]}),n.render=i=>i.replace(/\$(\$|[0-9A-Z]+)/gi,(o,s)=>s==="$"?"$":(D(s)?n.vars.unnamed[s-1]:n.vars.named[s])||""),n}});var Ie=class{constructor(t,r){this.cx=t,this.path=g(r)?r:(r+"").split("/").filter(n=>n)}async route(t,r,n,i,o=null){let s=this,f=this.cx.runtime,a=async function(u){let l={runtime:f};if(!u.trail||u.trail.length<u.destination.length){if(u=await s.readTick(u),l.pathname=`/${u.trail.join("/")}`,l.stepname=u.trail[u.trail.length-1],s.finalizeHandlerContext(l,u),u.exports){u.exports.hints&&await r.port.post({...u.exports.hints,$type:"handler:hints"});let c=M(u.method),m=R(u.exports)&&c.includes("default")?u.exports:c.reduce((p,N)=>p||u.exports[N.toLowerCase()],null);if(m){let p=async(...T)=>{let y={...u,arg:T[0]};if(T.length>1){var C=T[1],E,j={...T[2]||{}};if(T[1]instanceof y.event.Request)E=T[1],C=E.url;else if(!U(C))throw new Error("Router redirect url must be a string!");var B=C.startsWith("/")?C:s.pathJoin(`/${u.trail.join("/")}`,C);if(B.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+C+" >> "+B+")");j.method&&(y.method=j.method,g(j.method)&&(j.method=j.method[0])),E?y.event=u.event.retarget(E,{...j,_proxy:{url:B}}):y.event=u.event.retarget(B,j),y.source=u.destination.join("/"),y.destination=B.split("?").shift().split("/").map(v=>v.trim()).filter(v=>v),y.trail=T[1].startsWith("/")?[]:u.trail.reduce((v,k,H)=>v.length===H&&k===y.destination[H]?v.concat(k):v,[]),y.trailOnFile=u.trailOnFile.slice(0,y.trail.length)}return a(y)},N=u.destination.slice(u.trail.length);return p.pathname=N.join("/"),p.stepname=N[0],await m.call(l,u.event,u.arg,p,o)}return a(u)}else if((u.currentSegmentOnFile||{}).dirExists)return a(u)}if(i)return await i.call(l,u.event,u.arg,o)};return a({destination:this.path,event:r,method:t,arg:n})}};var Ne=class extends Ie{async readTick(t){var r=this.cx.layout,n=Object.keys(this.cx.layout);return t.trail?(t.currentSegment=t.destination[t.trail.length],t.currentSegmentOnFile=[t.currentSegment,"-"].reduce((i,o)=>{if(i.index)return i;var s=`/${t.trailOnFile.concat(o).join("/")}`;return r[s]?{seg:o,index:s}:n.filter(f=>f.startsWith(`${s}/`)).length?{seg:o,dirExists:!0}:i},{seg:null}),t.trail.push(t.currentSegment),t.trailOnFile.push(t.currentSegmentOnFile.seg),t.exports=r[t.currentSegmentOnFile.index]):(t.trail=[],t.trailOnFile=[],t.currentSegmentOnFile={index:"/"},t.exports=r["/"]),t}finalizeHandlerContext(t,r){return t.dirname=r.currentSegmentOnFile.index}pathJoin(...t){return xr.join(...t)}};var ke=class{constructor(t){this.cx=t}async handle(t,r){let n=new Ne(this.cx,t.url.pathname);return(async()=>{let o=t.request.method.toLowerCase(),s=await n.route([o==="delete"?"del":o,"default"],t,{},async f=>r(f.request),r);return s instanceof t.Response||(s=t.Response.compat(s)),s})()}};function x(e){return!Array.isArray(e)&&typeof e=="object"&&e}function I(e){return typeof e}function b(e,...t){globalThis.WebQitInternalsRegistry||(globalThis.WebQitInternalsRegistry=new Map);var r=globalThis.WebQitInternalsRegistry.get(e);if(!r){if(r=new Map,t[0]===!1)return r;globalThis.WebQitInternalsRegistry.set(e,r)}for(var n,i;n=t.shift();)if((i=r)&&!(r=r.get(n))){if(r=new Map,t[0]===!1)return r;i.set(n,r)}return r}function h(e){return Array.isArray(e)}function le(e){return typeof e=="function"}function Et(e){return le(e)&&/^class\s?/.test(Function.prototype.toString.call(e))}function Ze(e){return e===null||e===""}function z(e){return arguments.length&&(e===void 0||typeof e>"u")}function d(e){return Array.isArray(e)||typeof e=="object"&&e||le(e)}function At(e){return Ze(e)||z(e)||e===!1||e===0||d(e)&&!Object.keys(e).length}function _(e){return le(e)||e&&{}.toString.call(e)==="[object function]"}function ce(e){return e instanceof Number||typeof e=="number"}function W(e){return ce(e)||e!==!0&&e!==!1&&e!==null&&e!==""&&!isNaN(e*1)}function ve(e){return e instanceof String||typeof e=="string"&&e!==null}function Ct(e){return!ve(e)&&!z(e.length)}function $e(e,t=1){var r=0;e.forEach(i=>{r++});var n=e.slice(e.length-r,t);return arguments.length>1?n:n[0]}function De(e,t=1){return arguments.length>1?$e(e.slice().reverse(),t).reverse():$e(e.slice().reverse())}function Ke(e,...t){return t.forEach(r=>{e.indexOf(r)<0&&e.push(r)}),e}function Tt(n,t){t=t||Object.prototype,t=t&&!h(t)?[t]:t;for(var r=[],n=n;n&&(!t||t.indexOf(n)<0)&&n.name!=="default";)r.push(n),n=n?Object.getPrototypeOf(n):null;return r}function Rt(e,t){var r=[];return Tt(e,t).forEach(n=>{Ke(r,...Object.getOwnPropertyNames(n))}),r}function Q(e,t,r=!1,n=!1,i=!1){var o=0,s=e.shift();if((W(s)||s===!0||s===!1)&&(o=s,s=e.shift()),!e.length)throw new Error("_merge() requires two or more array/objects.");return e.forEach((f,a)=>{!d(f)&&!_(f)||(r?Rt(f):Object.keys(f)).forEach(u=>{if(!!t(u,s,f,a)){var l=s[u],c=f[u];if((h(l)&&h(c)||x(l)&&x(c))&&(o===!0||o>0))s[u]=h(l)&&h(c)?[]:{},Q([W(o)?o-1:o,s[u],l,c],t,r,n,i);else if(h(s)&&h(f))n?s[u]=c:s.push(c);else try{i?Object.defineProperty(s,u,Object.getOwnPropertyDescriptor(f,u)):s[u]=f[u]}catch{}}})}),s}function V(e,t){var r=void 0;return d(e)&&Object.keys(e).forEach((n,i)=>{r!==!1&&(r=t(W(n)?parseFloat(n):n,e[n],i))}),r}function me(...e){return Q(e,(t,r,n)=>!0,!1,!1,!1)}function Oe(e,t,r=null,n=!1){return t.length>e.length?-1:(typeof r=="number"?n?e.slice(0,r+1+(r<0?e.length:0)):e.slice(r):e).reduce((i,o,s)=>{var[f,a,u]=i;if(!n&&f>-1)return[f,a,u];var l=u+1,c=o===t[l]?l===0?[s,0]:[a,l]:[-1,-1];return c[1]===t.length-1&&(c[1]=-1,c[0]>-1)?[c[0]].concat(c):[f].concat(c)},[-1,-1,-1])[0]+(n||typeof r!="number"?0:r>-1?r:e.length-r)}function Se(e,t,r=null,n=!1){var i=Oe(e,t,r,n);return i===-1?[]:e.slice(i+t.length)}function Ft(e,t){return e.reduce((r,n,i)=>r||t(n,i),!1)}function O(e,t=!0){return h(e)?e:!t&&x(e)?[e]:e!==!1&&e!==0&&At(e)?[]:Ct(e)?Array.prototype.slice.call(e):x(e)?Object.values(e):[e]}function ee(e,t,r=null){return r||r!==!1&&e.dotSafe&&t.dotSafe?e.join(".")===t.join("."):e.length===t.length&&e.reduce((n,i,o)=>n&&i===t[o],!0)}function Ue(e,t,r=null){return h(t)?e.filter(n=>r?t.filter(i=>r(n,i)).length:t.indexOf(n)!==-1):[]}function Me(e,t,r=null){return r||r!==!1&&e.dotSafe&&t.dotSafe?(e.join(".")+".").startsWith(t.join(".")+"."):t.reduce((n,i,o)=>n&&i===e[o],!0)}function Lt(e){let t=(r,n,i)=>i.indexOf(r)===n;return e.filter(t)}function pe(e){return(jt(e)?e:O(e).length?[e]:[]).reduce((t,r)=>t.concat([O(r)]),[]).map(t=>te.resolve(t))}var te=class extends Array{static resolve(t){return t.every(r=>!(r+"").includes("."))?new te().concat(t):t}get dotSafe(){return!0}};function jt(e){return O(e).reduce((t,r)=>t||h(r),!1)}function It(e){return e.filter(t=>t||t===0).length!==e.length}function Or(e){return e.filter(t=>It(O(t))).length>0}var he=class{constructor(t){this.target=t,this.fireables=[],this.currentlyFiring=[]}add(t){return this.fireables.push(t),t}remove(t){this.fireables=this.fireables.filter(r=>r!==t)}removeMatches(t){this.match(t).forEach(r=>{this.fireables=this.fireables.filter(n=>n!==r)})}match(t){return this.fireables.filter(r=>{var n=pe(r.filter),i=O((r.params||{}).tags),o=pe(t.filter),s=O((t.params||{}).tags);return(!t.originalHandler||r.handler===t.originalHandler)&&(!o.length||ee(o,n))&&(!s.length||s.length===i.length&&Ue(i,s).length===s.length)})}static _getFirebase(t,r,n=!0,i=this.__namespace){if(!d(r))throw new Error('Subject must be of type object; "'+I(r)+'" given!');var o=this;return i&&globalThis.WebQitObserverNamespaceRegistry.has(t+"-"+i)&&(o=globalThis.WebQitObserverNamespaceRegistry.get(t+"-"+i),t+="-"+i),!b(r,"firebases").has(t)&&n&&b(r,"firebases").set(t,new o(r)),b(r,"firebases").get(t)}static _namespace(t,r,n=null){if(t+="-"+r,arguments.length===2)return globalThis.WebQitObserverNamespaceRegistry.get(t);if(!(n.prototype instanceof this))throw new Error(`The implementation of the namespace ${this.name}.${r} must be a subclass of ${this.name}.`);globalThis.WebQitObserverNamespaceRegistry.set(t,n),n.__namespace=r}};globalThis.WebQitObserverNamespaceRegistry||(globalThis.WebQitObserverNamespaceRegistry=new Map);var de=class{constructor(t,r){this.target=t,this.handler=r.handler,this.filter=r.filter,this.params=r.params}disconnect(){this.disconnected=!0}};var We=class extends de{fire(t,r,n){return this.disconnected||this.filter&&!Ue(O(this.filter),[t.type]).length?r(...Array.prototype.slice.call(arguments,2)):this.handler(t,n,r)}};function Je(e,t=[],r=!0){var n=0;return W(arguments[0])&&d(arguments[1])&&(n=arguments[0],e=arguments[1],t=arguments[2]||[]),Q([n,{},e],(i,o,s)=>_(t)?t(i):h(t)&&t.length?t.indexOf(i)>-1:!0,!1,!1,r)}var Pe=class{constructor(t,r){if(this.target=t,!r.type)throw new Error("Action type must be given in definition!");V(r,(n,i)=>{Object.defineProperty(this,n,{value:i,enumerable:!0})}),Object.seal(this)}};var F=class extends he{add(t){return super.add(new We(this.target,t))}fire(t,r=null){if(t instanceof Pe||(t=new Pe(this.target,t)),this.currentlyFiring.filter(o=>o.type===t.type&&o.name===t.name).length)return r?r():void 0;this.currentlyFiring.push(t);let n=(o,...s)=>{var f=this.fireables[o];return f?f.fire(t,(...a)=>n(o+1,...a),...s):r?r(...s):s[0]};var i=n(0);return this.currentlyFiring.pop(),i}static getFirebase(t,r=!0,n=null){return super._getFirebase("interceptor",...arguments)}static namespace(t,r=null){return super._namespace("interceptor",...arguments)}};function A(e){return b(e,!1).get(e)||e}function L(e,t,r={},n={}){if(!t||!d(t))throw new Error("Target must be of type object!");t=A(t);var i,o=function(s){return arguments.length?s:Reflect[e](t,...Object.values(r))};return(i=F.getFirebase(t,!1,n.namespace))?i.fire({type:e,...r},o):o()}function et(e,t,r,n={}){return L("apply",e,{thisArgument:t,argumentsList:r},n)}function tt(e,t,r=null,n={}){return L("construct",e,arguments.length>2?{argumentsList:t,newTarget:r}:{argumentsList:t},n)}var G=class{constructor(t,r=!1){this._={},this._.target=t,this._.cancellable=r,this._.propagationStopped=!1,this._.defaultPrevented=!1,this._.promisesInstance=null,this._.promises=[]}get target(){return this._.target}get cancellable(){return this._.cancellable}stopPropagation(){this._.propagationStopped=!0}get propagationStopped(){return this._.propagationStopped}preventDefault(){this._.defaultPrevented=!0}get defaultPrevented(){return this._.defaultPrevented}waitUntil(t){t instanceof Promise&&(this._.promises.push(t),this._.promisesInstance=null)}get promises(){return!this._.promisesInstance&&this._.promises.length&&(this._.promisesInstance=Promise.all(this._.promises)),this._.promisesInstance}respondWith(t){var r,n=x(t)&&!z(t.propagationStopped)&&!z(t.defaultPrevented);t===!1||n&&t.propagationStopped?this.stopPropagation():t===!1||n&&t.defaultPrevented?this.preventDefault():(t instanceof Promise&&(r=t)||n&&(r=t.promises))&&this.waitUntil(r)}};var He=class extends de{constructor(t,r){if(super(t,r),this.filters2D=pe(this.filter),this.filtersIsOriginally2D=jt(this.filter),this.filtersIsDynamic=Or(this.filters2D),this.filtersIsDynamic&&this.filters2D.length>1)throw new Error('Only one "Dynamic Filter" must be observed at a time! "'+this.filters2D.map(n=>"["+n.join(", ")+"]").join(", ")+'" have been bound together.')}fire(t){if(this.disconnected||this.params.type&&!Ft(t,s=>this.params.type===s.type))return;let r=s=>!["set","def"].includes(s.type)||!this.params.diff||(_(this.params.diff)?this.params.diff(s.value,s.oldValue):s.value!==s.oldValue);var n=new G(this.target);if(this.filters2D.length){var i=t.filter(s=>this.filters2D.filter((f,a)=>{var u=f.slice();return this.filtersIsDynamic&&s.path.forEach((l,c)=>{u[c]=u[c]||u[c]===0?u[c]:l}),(!this.filtersIsDynamic||!It(u))&&r(s)&&(!this.params.subtree&&ee(u,s.path)||this.params.suptree&&Me(u,s.path)&&(!W(this.params.suptree)||Se(u,s.path).length<=this.params.suptree)||this.params.subtree&&s.path.length>=u.length&&Me(s.path,u)&&(!W(this.params.subtree)||Se(s.path,u).length<=this.params.subtree))}).length);if(i.length)if(this.filtersIsOriginally2D||this.params.subtree){var o=i;x(this.filter)&&(o={...this.filter},i.forEach((s,f)=>{o[s.name]=s})),n.respondWith(this.handler(o,n))}else i.forEach((s,f)=>{n.respondWith(this.handler(s,n))})}else(this.params.subtree||t.filter(s=>ee(s.path,[s.name])).length===t.length)&&t.filter(s=>r(s)).length&&n.respondWith(this.handler(t,n));return n}};var re=class{constructor(t,r){if(this.target=t,r.originalSubject||(this.originalSubject=t),!("type"in r))throw new Error("Mutation type must be given in definition!");if(!("name"in r))throw new Error("Property name must be given in definition!");V(r,(n,i)=>{n==="path"&&(i=te.resolve(i)),Object.defineProperty(this,n,{value:i,enumerable:!0})}),this.path||Object.defineProperty(this,"path",{value:te.resolve([r.name]),enumerable:!0}),Object.seal(this)}};var S=class extends he{constructor(t){super(t),this.buffers=[]}add(t){return super.add(new He(this.target,t))}fire(t,r){var n=new G(this.target,r);return t=O(t,!1).map(i=>i instanceof re?i:new re(this.target,i)),this.buffers.length?(De(this.buffers)(t),n):(this.currentlyFiring.filter(i=>t.filter(o=>i.type===o.type&&i.name===o.name).length).length,this.fireables.forEach(i=>{if(n.propagationStopped&&r)return n;n.respondWith(i.fire(t))}),n)}static getFirebase(t,r=!0,n=null){return super._getFirebase("observer",...arguments)}static namespace(t,r=null){return super._namespace("observer",...arguments)}};function q(e,t,r=null,n={}){if(e=r||e,!e||!d(e))throw new Error("Target must be of type object!");e=A(e);var i=O(t),o=i.map(s=>{var f,a=function(u){return arguments.length?u:b(e,"accessorizedProps").has(s)&&b(e,"accessorizedProps").get(s).touch(!0)?b(e,"accessorizedProps").get(s).get():r?Reflect.get(e,s,r):Reflect.get(e,s)};return(f=F.getFirebase(e,!0,n.namespace))?f.fire({type:"get",name:s,related:i,receiver:r},a):a()});return h(t)?o:o[0]}function rt(e,t,r=null,n={}){if(e=A(e),!e||!d(e))throw new Error('Observable subjects must be of type object; "'+I(e)+'" given!');if(_(t)&&(n=arguments.length>2?r:{},r=t,t=null),!_(r))throw new Error('Handler must be a function; "'+I(r)+'" given!');var i,o=S.getFirebase(e,!0,n.namespace),s={filter:t,handler:r,params:n};if((s.filter||s.params.subtree==="*"||s.params.subtree&&Ee(e))&&ne(e,s.filter,s.params.subtree,n.namespace),s.params.unique&&(i=o.match({filter:t,params:n})).length){if(s.params.unique!=="replace")return i[0];o.remove(i[0])}return o.add(s)}function ie(e,t,r,n=null,i={}){if(e!==r){var o;if(rt(r,(f,a)=>{if(o=S.getFirebase(e,!1,i.namespace)){var u=f.map(l=>{var c=l;do if(c.target===e)return;while(c=c.src);var m={};return V(l,(p,N)=>{p!=="target"&&p!=="name"&&p!=="path"&&p!=="src"&&(m[p]=N)}),m.name=t,m.path=[t].concat(l.path),m.originalSubject=l.originalSubject,m.src=l,new re(e,m)}).filter(l=>l);if(u.length)return o.fire(u,a.cancellable)}},{subtree:!0,...i,unique:!0,tags:[kt,t,e]}),x(n)&&(o=S.getFirebase(e,!1,i.namespace))){var s=me({name:t,type:"set",value:r,related:[t]},n);let f=o.fire(s,i.cancellable);if(i.eventTypeReturn)return f}}}var kt={};function ne(e,t=null,r=!1,n=null){if(!e||!d(e))throw new Error("Target must be of type object!");var i=S.getFirebase(e,!0,n);if(!(!i||i.build)){i.build=r;var o=pe(t),s=!o.length||o.filter(a=>!a[0]&&a[0]!==0).length?Object.keys(e):o.map(a=>a[0]),f=o.length?o.map(a=>a.slice(1)).filter(a=>a.length):null;i.subBuild=f&&f.length?f:null,s.forEach(a=>{var u=q(e,a,null,{namespace:n});try{d(u)&&(ie(e,a,u,null,params),(i.subBuild&&Ee(u)||(_isFunction(r)?r(u):r&&Ee(u)))&&ne(u,i.subBuild,r,n))}catch{}})}}var Ee=e=>(e instanceof Object||e instanceof Array||e instanceof Function)&&(typeof window>"u"||e!==window);function nt(e,t,r=null,n={}){if(e=A(e),!e||!d(e))throw new Error('Observable subjects must be of type object; "'+I(e)+'" given!');if(_(t)&&(n=arguments.length>2?r:{},r=t,t=null),r&&!_(r))throw new Error('Handler must be a function; "'+I(r)+'" given!');var i;if(i=S.getFirebase(e,!1,n.namespace))return i.removeMatches({filter:t,originalHandler:r,params:n})}function oe(e,t,r,n=null,i={}){nt(r,null,null,{...i,tags:[kt,t,e]});var o;if(x(n)&&(o=S.getFirebase(e,!1,i.namespace))){var s=me({name:t,type:"del",oldValue:r,related:[t]},n);o.fire(s,i.cancellable)}}function se(e,t,r={}){return L("has",e,{name:t},r)}function it(e,t,r,n={}){t=r.receiver||t;var i=r.keysOrPayload,o=r.value;if(!t||!d(t))throw new Error("Target must be of type object!");x(i)&&(n=o||{},o=null),t=A(t);var s=F.getFirebase(t,!1,n.namespace),f=S.getFirebase(t,!1,n.namespace);let a=(p,N,T,y)=>{var C="set",E;e&&(C="defineProperty",E=N||{},N=E.value);var j=!1,B;se(t,p,n)&&(j=!0,B=q(t,p,r.receiver,n));var v={name:p,type:C,value:N,receiver:r.receiver,related:T,detail:y,isUpdate:j,oldValue:B},k=function(ze){return arguments.length&&(E?E=ze:N=ze),E?b(t,"accessorizedProps",!1).has(p)&&!b(t,"accessorizedProps").get(p).restore()?!1:(Object.defineProperty(t,p,E),!0):b(t,"accessorizedProps",!1).has(p)?b(t,"accessorizedProps").get(p).set(N):(t[p]=N,!0)};if(s){var H=E?{type:"defineProperty",name:p,descriptor:E,receiver:r.receiver,related:T,detail:y,isUpdate:j,oldValue:B}:{type:"set",name:p,value:N,receiver:r.receiver,related:T,detail:y,isUpdate:j,oldValue:B};v.success=s.fire(H,k)}else v.success=k();return v.success&&v.value!==v.oldValue&&(d(v.oldValue)&&oe(t,p,v.oldValue,null,n),d(v.value)&&(ie(t,p,v.value,null,n),f&&(f.subBuild||f.build&&Ee(v.value))&&ne(v.value,f.subBuild,f.build,n.namespace))),v};var u,l=[];h(i)||(ve(i)||ce(i))&&(u=O(i))?l=u.map(p=>a(p,o,u,n.detail)):x(i)&&(u=Object.keys(i))&&(l=u.map(p=>a(p,i[p],u,n.detail)));var c=l.filter(p=>p.success!==!1),m;return f?(m=f.fire(c,n.cancellable),m.successCount=c.length):n.eventTypeReturn&&(m=new G(t)),n.eventTypeReturn?m:c.length>0}function ot(e,t,r=null,n={}){return it(!0,e,{keysOrPayload:t,value:r},n)}function st(e,t,r={}){if(!e||!d(e))throw new Error("Target must be of type object!");e=A(e);var n=O(t),i=n.map(a=>{var u;se(e,a,r)&&(u=q(e,a,null,r));var l={name:a,type:"deleteProperty",related:n,detail:r.detail,oldValue:u},c,m=function(p){return arguments.length?p:b(e,"accessorizedProps",!1).has(a)&&!b(e,"accessorizedProps").get(a).restore()?!1:(delete e[a],!0)};return(c=F.getFirebase(e,!1,r.namespace))?l.success=c.fire({type:"deleteProperty",name:a,oldValue:u,related:n},m):l.success=m(),l.success&&d(l.oldValue)&&oe(e,a,l.oldValue,null,r),l}),o=i.filter(a=>a.success!==!1),s,f;return(s=S.getFirebase(e,!1,r.namespace))?(f=s.fire(o,r.cancellable),f.successCount=o.length):r.eventTypeReturn&&(f=new G(e)),r.eventTypeReturn?f:o.length>0}function ft(e,t,r={}){return L("getOwnPropertyDescriptor",e,{name:t},r)}function at(e,t={}){return L("getPrototypeOf",e,{},t)}function ut(e,t={}){return L("isExtensible",e,{},t)}function lt(e,t={}){return L("ownKeys",e,{},t)}function ct(e,t={}){return L("preventExtensions",e,{},t)}function Ae(e,t,r=null,n=null,i={}){return it(!1,e,arguments.length>3?{keysOrPayload:t,value:r,receiver:n}:{keysOrPayload:t,value:r},i)}function mt(e,t,r={}){return L("setPrototypeOf",e,{prototype:t},r)}function Pr(e,t=[],r={}){r=x(t)?t:r;var n=(arguments.length===1?Object.keys(e):O(t)).map(i=>{if(b(e,"accessorizedProps").has(i)&&b(e,"accessorizedProps").get(i).touch(!0))return!1;let o=()=>{for(var m,p=e;!m&&(p=Object.getPrototypeOf(p));)m=Object.getOwnPropertyDescriptor(p,i);return m};var s=Object.getOwnPropertyDescriptor(e,i),f,a;s||(f={writable:!0,enumerable:!(i in e),configurable:r.configurable!==!1});var u={...s||f};"value"in u&&delete u.value,"writable"in u&&delete u.writable,u.get=()=>{if(c.ongoingGets.length)return c.get();c.ongoingGets.push(1);var m=q(e,i,null,r);return c.ongoingGets.pop(),m};var l;u.set=m=>{if(c.ongoingSets.length)return c.set(m);c.ongoingSets.push(1);var p=Ae(e,i,m,null,r);return c.ongoingSets.pop(),p};var c={ongoingGets:[],ongoingSets:[],get:function(){var m=s;return m||(a?m=f:m=o()||f),m.get?m.get.call(e):m.value},set:function(m){var p=s;return p||(a?p=f:(p=o())?"value"in p&&(p=f,a=!0):(p=f,a=!0)),p.set||p.get?p.set?p.set.call(e,m):!1:(p.value=m,!0)},restore:function(){try{return this.intact()&&(s||a?Object.defineProperty(e,i,s||f):delete e[i],b(e,"accessorizedProps").delete(i)),!0}catch{}return!1},intact:function(){return(Object.getOwnPropertyDescriptor(e,i)||{}).get===u.get},touch:function(m=!1){return this.intact()||(m?!this.restore():!1)}};try{return Object.defineProperty(e,i,u),b(e,"accessorizedProps").set(i,c),!0}catch{}return!1});return h(t)?n:n[0]}function Er(e,t=[],r={}){r=x(t)?t:r;var n=(arguments.length===1?Object.keys(e):O(t)).map(i=>b(e,"accessorizedProps",!1).has(i)?b(e,"accessorizedProps").get(i).restore():!0);return h(t)?n:n[0]}function Ar(e,t={}){if(!d(e))throw new Error('Object must be of type target; "'+I(e)+'" given!');var r=new Proxy(e,{apply:(n,i,o)=>et(n,i,o,t),construct:(n,i,o=null)=>tt(n,i,o,t),defineProperty:(n,i,o)=>ot(n,i,o,t),deleteProperty:(n,i)=>st(n,i,t),get:(n,i,o=null)=>{var s=q(n,i,o,t);return t.proxyAutoBinding!==!1&&_(s)&&!Et(s)?s.bind(r):s},getOwnPropertyDescriptor:(n,i)=>ft(n,i,t),getPrototypeOf:n=>at(n,t),has:(n,i)=>se(n,i,t),isExtensible:n=>ut(n,t),ownKeys:n=>lt(n,t),preventExtensions:n=>ct(n,t),set:(n,i,o,s=null)=>Ae(n,i,o,s,t),setPrototypeOf:(n,i)=>mt(n,i,t)});return b(r).set(r,e),r}function Cr(e,t,r={}){if(e=A(e),!d(e))throw new Error('Object must be of type target; "'+I(handler)+'" given!');var n={},i=!0;x(t)||(_(t)?t={"":t}:_(r)&&(t={[t]:r},r=arguments.length>3?arguments[3]:{}),i=!1);var o=F.getFirebase(e,!0,r.namespace);return Object.keys(t).forEach(s=>{if(!_(t[s]))throw new Error("Callback"+(s===null?"":" for "+s)+' must be a function; "'+I(t[s])+'" given!');var f={filter:s,handler:t[s],params:r},a;if(f.params.unique&&(a=o.match(f)).length){if(f.params.unique!=="replace")return a[0];o.remove(a[0])}i?n[s]=o.add(f):n=o.add(f)}),n}function Tr(e,t=null,r={}){if(e=A(e),!e||!d(e))throw new Error('Object must be of type target; "'+I(e)+'" given!');var n=F.getFirebase(e,!1,r.namespace);_isObject(t)||(_(t)?t={[null]:t}:_(r)&&(t={[t]:r},r=arguments.length>3?arguments[3]:{}),isOriginallyObj=!1),(n=F.getFirebase(e,!1,r.namespace))&&Object.keys(t).forEach(i=>{if(!_(t[i]))throw new Error("Callback"+(i===null?"":" for "+i)+' must be a function; "'+I(t[i])+'" given!');var o={filter:i,originalHandler:t[i],params:r};return n.removeMatches(o)})}function Rr(e,...t){var r=t.map(o=>{if(o=A(o),!d(o))throw new Error("Target must be of type object!");return{target:o,subjectCopy:h(o)?o.slice(0):Je(o)}}),n=e(...t);let i=()=>{r.map(o=>{var s=Object.keys(o.subjectCopy),f=Object.keys(o.target),a=[],u=Lt(s.concat(f)).map(c=>{if(o.subjectCopy[c]!==o.target[c]){a.push(c);var m={name:c,related:a,buffered:!0};return f.includes(c)?(m.type="set",m.value=o.target[c],s.includes(c)&&(m.isUpdate=!0)):m.type="del",s.includes(c)&&(m.oldValue=o.subjectCopy[c]),d(o.subjectCopy[c])&&oe(o.target,c,o.subjectCopy[c]),d(o.target[c])&&ie(o.target,c,o.target[c]),m}}).filter(c=>c),l;if(u.length&&(l=S.getFirebase(o.target,!1)))return l.fire(u)})};return n instanceof Promise?n.then(i):i(),n}var P={apply:et,construct:tt,defineProperty:ot,deleteProperty:st,get:q,getOwnPropertyDescriptor:ft,getPrototypeOf:at,has:se,isExtensible:ut,ownKeys:lt,preventExtensions:ct,set:Ae,setPrototypeOf:mt,accessorize:Pr,unaccessorize:Er,proxy:Ar,unproxy:A,observe:rt,unobserve:nt,intercept:Cr,unintercept:Tr,closure:Rr,build:ne,link:ie,unlink:oe,Observers:S,Interceptors:F};var{URL:Fr,fetch:Lr,Headers:Dt,Request:jr,Response:Ir,FormData:Nr,ReadableStream:ni,File:ZO,Blob:Ut}=globalThis;var oi=e=>{let t=class extends e{constructor(...r){super(...r);var n=ue(this.search);let i=o=>{var s=be(o);s=s?"?"+s:"",s!==this.search&&(this.search=s)};this.__query={value:n,proxy:new Proxy(n,{set(o,s,f){return o[s]=f,i(o),!0},deleteProperty(o,s){return delete o[s],i(o),!0}})}}set search(r){super.search=r;var n=ue(r);Mt(n,this.query)||(this.query=n)}get search(){return super.search}get query(){return this.__query.proxy}};return t.Observable=class extends t{constructor(){super(...arguments);let{Observer:r}=WebQit;r.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}},t},Mt=(e,t)=>w(e)&&w(t)?Mt(Object.keys(e),Object.keys(t))&&Mt(Object.values(e),Object.values(t)):g(e)&&g(t)?e.length===t.length&&e.reduce((r,n,i)=>r&&n===t[i],!0):e===t,kr=oi;var si=e=>class extends e{tee(t=null){let r=new this.constructor,n=new this.constructor;for(var[i,o]of this.entries()){let s=s(o);t&&t(o,i,s)||!t&&!s?r.append(i,o):n.append(i,o)}return[r,n]}json(t={},r=null){if(arguments.length){Object.keys(t).forEach(s=>{Xe(s,t[s],(f,a)=>{(!r||r(f,a,$(a)))&&this.append(f,a)},f=>!Wt(f))});return}var n;for(var[i,o]of this.entries())n||(n=D(ye(i,"["))?[]:{}),Ve(n,i,o);return n}},$r=si,Wt=(e,t=null)=>{if(!$(e))return;let r=e[Symbol.toStringTag];return(t||["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream"]).reduce((n,i)=>n||(r===i?i:null),null)};var fi=e=>class extends e{constructor(t={}){t instanceof e?super(t):(super(),this.json(t))}json(t={},r=!0){if(arguments.length){let s=Dr(this),f=Object.keys(s).reduce((a,u)=>a.concat(typeof u!="symbol"&&"set"in s[u]?u:[]),[]);Object.keys(t).forEach(a=>{var u=f.reduce((l,c)=>l||(c===a||c.toLocaleLowerCase()===a?c:null),null);u?(r||this[u]===void 0)&&(this[u]=t[a]):(r||!this.has(a))&&this.set(a,t[a])});return}let n={};for(var[i,o]of this)n[i]=o;return n}set cacheControl(t){return this.set("Cache-Control",t)}get cacheControl(){return this.get("Cache-Control")}set contentLength(t){return this.set("Content-Length",t)}get contentLength(){return this.get("Content-Length")}set contentType(t){return this.set("Content-Type",t)}get contentType(){return this.get("Content-Type")}},ht=fi;function Dr(e){if(e){let t=Object.getPrototypeOf(e);return t===Object.prototype?{}:{...Dr(t),...Object.getOwnPropertyDescriptors(e)}}else return Object.create(null)}var ai=e=>class extends ht(e){set accept(t){return this.set("Accept",t)}get accept(){let t=this.get("Accept"),r=t&&t.split(",").map(n=>(n=n.trim().split(";").map(i=>i.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,i)=>n[1]>i[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((i,o)=>i||(o=o[0].split("/"))&&[0,1].every(s=>n[s]===o[s]||n[s]==="*"||o[s]==="*"),!1)},toString(){return t}}}set cookies(t){if(!w(t))throw new Error(`Cookies must be of type object. Received type: ${ge(t)}.`);return this.set("Cookie",be(t,";")),this._cookies=null,!0}get cookies(){return this._cookies||(this._cookies=ue(this.get("cookie"),{},";")),this._cookies}set range(t){let r=[];return M(t).forEach((n,i)=>{let o=Array.isArray(n)?n.join("-"):n+"";i===0&&!o.includes("bytes=")&&(o=`bytes=${o}`),r.push(o)}),this.set("Range",r.join(", "))}get range(){let t=this.get("Range");return t?Z(t,"bytes=").split(",").map(n=>{let i=n.trim().split("-");return i[0]=i[0]?parseInt(i[0],10):void 0,i[1]&&(i[1]=parseInt(i[1],10)),i.clamp=o=>{(i[1]>o-1||i[1]===void 0)&&(i[1]=o-1),i[0]===void 0&&(i[0]=i[1]?o-i[1]-1:0)},i}):void 0}set cors(t){return this.set("Access-Control-Allow-Origin",t===!0?"*":t===!1?"":t)}get cors(){return this.get("Access-Control-Allow-Origin")}},Ur=ai;var ui=e=>class extends ht(e){set cookies(t){if(!w(t))throw new Error(`The "cookies" response directive cannot be of type: ${ge(t)}`);for(let r in t){let n=t[r];if(w(n)){let i=[n.value];for(let o in n){if(o==="value")continue;let s=o[0].toUpperCase()+o.substring(1);s==="MaxAge"&&(s="Max-Age"),i.push(n[o]===!0?s:`${s}=${n[o]}`)}n=i.join("; ")}this.append("Set-Cookie",`${r}=${n}`)}return!0}get cookies(){let t=this.get("Set-Cookie");return t&&t.split(",").reduce((r,n)=>{let[i,o]=n.split(";"),[s,f]=i.trim().split("=");return r[s]={value:f},o&&(o||"").split(/\;/g).map(a=>a.trim().split("=")).forEach(a=>{r[s][a[0][0].toLowerCase()+a[0].substring(1).replace("-","")]=a.length===1?!0:a[1]}),r},{})}set contentRange(t){if(Array.isArray(t)){if(t.length===2&&!t[0].includes("-")||t.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${t.join("/")}`)}return this.set("Content-Range",t)}get contentRange(){let t=this.get("Content-Range");return t&&Z(t,"bytes ").split("/")}set cors(t){return this.set("Access-Control-Allow-Origin",t===!0?"*":t===!1?"":t)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(t){if(t=t===!0?"attachment":t===!1?"inline":t,!U(t))throw new Error(`The "download" response directive does not support the type: ${ge(t)}`);return["attachment","inline"].includes(t)||(t=`attachment; filename="${t}"`),this.set("Content-Disposition",t)}get attachment(){var t=(this.get("Content-Disposition")||"").trim();return t=t==="attachment"?!0:t==="inline"?!1:Z(ae(t,'"'),'filename="'),t}get location(){return this.get("Location")}set location(t){return this.set("Location",t)}get redirect(){return this.get("Location")}set redirect(t){return this.set("Location",t)}},Mr=ui;var li=(e,t,r)=>{let n=class extends e{constructor(i,o,s){"headers"in o&&!(o.headers instanceof t)&&(o={...o},o.headers=new t(o.headers),arguments[1]=o),K(o)?super(i):super(i,o),this._headers=o.headers,s.headers&&this.headers.json(s.headers);let f={};Object.defineProperty(this,"attrs",{get:()=>f}),Object.defineProperty(this,"bodyAttrs",{get:()=>s})}clone(){return new this.constructor(super.clone())}get headers(){return this._headers||(this._headers=new t(super.headers)),this._headers}get attrs(){return this.attrs}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.bodyAttrs.arrayBuffer?this.bodyAttrs.arrayBuffer:super.arrayBuffer()}async blob(){return this.bodyAttrs.blob?this.bodyAttrs.blob:super.blob()}async formData(){if(this.bodyAttrs.formData)return this.bodyAttrs.formData;let i=await super.formData();return i.tee=r.prototype.tee.bind(i),i.json=r.prototype.json.bind(i),i}async json(){return this.bodyAttrs.json?this.bodyAttrs.json:super.json()}async text(){return this.bodyAttrs.text?this.bodyAttrs.text:super.text()}jsonfy(i=!1){return(!this.bodyAttrs.jsonfied||i)&&(this.bodyAttrs.jsonfied=new Promise(async(o,s)=>{var f=this,a,u=f.headers.get("content-type")||"",l=u==="application/json"||this.bodyAttrs.json?"json":u==="application/x-www-form-urlencoded"||u.startsWith("multipart/form-data")||this.bodyAttrs.formData?"formData":u==="text/plain"?"plain":"other";try{l==="formData"?a=(await f.formData()).json():a=l==="json"?await f.json():l==="plain"?await f.text():f.body,o(a)}catch(c){s(c)}})),this.bodyAttrs.jsonfied}};return n.Headers=t,n},dt=li;function gt(e,t,r){let n={body:e,input:e},i=(f,a)=>{if(!t.encode)return;let[u,l]=t.encode(a);f.body=u,f.headers=l};if(U(e)||fe(e))return n.inputType="text",n.text=e,n.headers={contentLength:(e+"").length},n;if(n.inputType=Wt(e),["Blob","File"].includes(n.inputType))n.blob=e,n.headers={contentType:e.type,contentLength:e.size};else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n.inputType))n.arrayBuffer=e,n.headers={contentLength:e.byteLength};else if(n.inputType==="FormData")n.formData=e,i(n,e);else if(w(e)&&Ge(e)||g(e)&&xt(e)){n.inputType="object";var o,s=new t;s.json(e,(f,a,u)=>(o=o||u,!0)),o?(n.formData=s,i(n,s)):(n.json=e,n.body=JSON.stringify(e),n.headers={contentType:"application/json",contentLength:new r([n.body]).size}),n.jsonfied=e}return n}var ci=(e,t,r,n)=>class extends dt(e,t,r){constructor(i,o={}){o={...o};let s={};i instanceof e&&(o.method&&i.method!==o.method.toUpperCase()&&["GET","HEAD"].includes(o.method.toUpperCase())?(i=i.url,["headers","mode","credentials","cache","redirect","referrer","integrity"].forEach(a=>{a in o||(o[a]=i[a])})):s=i.bodyAttrs||{}),"body"in o&&(s=gt(o.body,r,n),o.body=s.body);let f;o.mode==="navigate"&&(f=!0,o={...o},delete o.mode),super(i,o,s),f&&(this.attrs.mode="navigate")}get mode(){return"mode"in this.attrs?this.attrs.mode:super.mode}get cache(){return"cache"in this.attrs?this.attrs.cache:super.cache}get destination(){return"destination"in this.attrs?this.attrs.destination:super.destination}get referrer(){return"referrer"in this.attrs?this.attrs.referrer:super.referrer}static compat(i,o=null){return i instanceof e?Object.setPrototypeOf(i,new this):new this(o,i)}},Wr=ci;var mi=(e,t,r,n)=>class extends dt(e,t,r){constructor(i=null,o={}){let s={},f;arguments.length&&(i instanceof e?(f=i,o={status:i.status,statusText:i.statusText,headers:i.headers,...o},i.status===0&&delete o.status,s=i.bodyAttrs||{},i=i.body):(s=gt(i,r,n),i=s.body)),super(i,o,s),f&&(this.attrs.url=f.url,this.attrs.ok=f.ok,this.attrs.status=f.status,this.attrs.type=f.type,this.attrs.redirected=f.redirected)}get ok(){return"ok"in this.attrs?this.attrs.ok:super.ok}get status(){return"status"in this.attrs?this.attrs.status:super.status}get statusText(){return"statusText"in this.attrs?this.attrs.statusText:super.statusText}get type(){return"type"in this.attrs?this.attrs.type:super.type}get redirected(){return"redirected"in this.attrs?this.attrs.redirected:super.redirected}static compat(i){return i instanceof e?Object.setPrototypeOf(i,new this):new this(i)}},Hr=mi;var pi=e=>e,qr=pi;var hi=(e,t,r)=>{let n=class{constructor(i,o,s){this._request=i,this._detail=o||{},this._sessionFactory=s,this.Request=e,this.Response=t,this.URL=r,this.port={listeners:[],post(f){let a=this.listeners.map(u=>u(f)).filter(u=>u instanceof Promise);if(process.length)return Promise.all(a)},listen(f){this.listeners.push(f)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory().get()),this._session}sessionFactory(...i){return this._sessionFactory(...i)}retarget(i,o={}){var s;return i instanceof e?K(o)?s=i:s=new e(i,o):(s=new e(this._request,o),s.attrs.url=`${this.url.origin}${i}`,s.attrs.referrer=this.request.url),new n(s,this.detail)}};return n},Br=hi;var zr=kr(Fr),Ht=$r(Nr);var Qr=Ur(Dt),Gr=Mr(Dt),_t=Wr(jr,Qr,Ht,Ut),Ce=Hr(Ir,Gr,Ht,Ut),di=qr(Lr),qt=Br(_t,Ce,zr);var qe=class{constructor(){this.messaging={post:(t,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return r.postMessage(t),this.post},listen:(t,r=this.client)=>r?(r.addEventListener("message",t),this.post):(self.addEventListener("message",n=>{this.client=n.source,t(n)}),this.post),request:(t,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return new Promise(n=>{let i=new MessageChannel;r.postMessage(t,[i.port2]),i.port1.onmessage=o=>n(o.data)})},channel(t){this.channels.has(t)||this.channels.set(t,new BroadcastChannel(r));let r=this.channels.get(t);return{broadcast:n=>r.postMessage(n),listen:n=>r.addEventListener("message",n)}},channels:new Map},this.notifications={fire:(t,r={})=>new Promise((n,i)=>{if(!(self.Notification&&self.Notification.permission==="granted"))return i(self.Notification&&self.Notification.permission);o.addEventListener("error",i);let o=new self.Notification(t,r);o.addEventListener("click",n),o.addEventListener("close",n)}),handle:t=>(self.addEventListener("notificationclick",t),this.notifications)},this.push={listen:t=>(self.addEventListener("push",t),this.post)}}setCurrentClient(t){this.client=t}};var Be=class{constructor(t,r){this.cx=t,this.clients=new Map,this.mockSessionStore={},this.cx.runtime=this;let n=r(this.cx,"*");if(!n||!n.handle)throw new Error('Application instance must define a ".handle()" method.');this.clients.set("*",n),self.addEventListener("install",o=>{this.cx.params.skip_waiting&&self.skipWaiting(),this.cx.params.cache_name&&(this.cx.params.cache_only_urls||[]).length&&o.waitUntil(self.caches.open(this.cx.params.cache_name).then(s=>{this.cx.logger&&this.cx.logger.log("[ServiceWorker] Pre-caching resources.");let f=(this.cx.params.cache_only_urls||[]).map(a=>a.trim()).filter(a=>a&&!Pt(a,self.origin).isPattern());return s.addAll(f)}))}),self.addEventListener("activate",o=>{o.waitUntil(new Promise(async s=>{this.cx.params.skip_waiting&&await self.clients.claim(),this.cx.params.cache_name&&await self.caches.keys().then(f=>Promise.all(f.map(a=>{if(a!==this.cx.params.cache_name&&a!==this.cx.params.cache_name+"_json")return this.cx.logger&&this.cx.logger.log("[ServiceWorker] Removing old cache:",a),self.caches.delete(a)}))),s()}))}),P.set(this,"location",{}),P.set(this,"network",{}),P.observe(this.network,o=>{}),self.addEventListener("fetch",o=>{!o.request.url.startsWith("http")||o.respondWith((async(s,f)=>{let a=await self.clients.get(o.clientId);this.workport.setCurrentClient(a);let u=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((l,c)=>({[c]:s[c],...l}),{});return["GET","HEAD"].includes(s.method)||(u.body=await s.text()),s.cache==="force-cache"&&(u.cache="default"),this.go(s.url,u,{event:f})})(o.request,o))});let i=new qe;P.set(this,"workport",i),i.messaging.listen(async o=>{let s=o.ports[0],f=this.clients.get("*"),a=f.alert&&await f.alert(o);s&&(a instanceof Promise?a.then(u=>{s.postMessage(u)}):s.postMessage(a))}),i.push.listen(async o=>{let s=this.clients.get("*");s.alert&&await s.alert(o)})}async go(t,r={},n={}){t=typeof t=="string"?new URL(t):t,r={referrer:this.location.href,...r};let i=await this.generateRequest(t.href,r);n.event&&Object.defineProperty(n.event,"request",{value:i});let o=new qt(i,n,(a=null,u=!1)=>this.getSession(o,a,u));o.port.listen(a=>{if(a.$type==="handler:hints"&&a.session)return Promise.resolve()});let s;return o.request.url.startsWith(self.origin)?s=await this.clients.get("*").handle(o,(...a)=>this.remoteFetch(...a)):s=await this.remoteFetch(o.request),this.handleResponse(o,s)}generateRequest(t,r){return new _t(t,r)}getSession(t,r=null,n=!1){return{get:()=>this.mockSessionStore,set:i=>{this.mockSessionStore=i}}}remoteFetch(t,...r){arguments.length>1&&(t=this.generateRequest(t,...r));let n=(s,f)=>Ot((s||[]).map(a=>a.trim()).filter(a=>a),a=>Pt(a,self.origin).test(f)),o=(()=>{if(!this.cx.params.default_fetching_strategy||this.cx.params.default_fetching_strategy==="network-first"||n(this.cx.params.network_first_urls,t.url))return P.set(this.network,"strategy","network-first"),this.networkFetch(t,{cacheFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="cache-first"||n(this.cx.params.cache_first_urls,t.url))return P.set(this.network,"strategy","cache-first"),this.cacheFetch(t,{networkFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="network-only"||n(this.cx.params.network_only_urls,t.url))return P.set(this.network,"strategy","network-only"),this.networkFetch(t,{cacheFallback:!1,cacheRefresh:!1});if(this.cx.params.default_fetching_strategy==="cache-only"||n(this.cx.params.cache_only_urls,t.url))return P.set(this.network,"strategy","cache-only"),this.cacheFetch(t,{networkFallback:!1,cacheRefresh:!1})})(t);return o.catch(s=>P.set(this.network,"error",s.message)),o.then(s=>Ce.compat(s))}networkFetch(t,r={}){return r.cacheFallback?self.fetch(t).then(n=>(r.cacheRefresh&&this.refreshCache(t,n),P.set(this.network,"remote",!0),n)).catch(()=>this.getRequestCache(t).then(n=>(P.set(this.network,"cache",!0),n.match(t)))):(P.set(this.network,"remote",!0),self.fetch(t))}cacheFetch(t,r={}){return this.getRequestCache(t).then(n=>n.match(t).then(i=>!i&&r.networkFallback?this.networkFetch(t,{...r,cacheFallback:!1}):(i&&r.cacheRefresh&&this.networkFetch(t,{...r,justRefreshing:!0}),P.set(this.network,"cache",!0),i)))}refreshCache(t,r){if(t.method!=="GET"||!r||r.status!==200||r.type!=="basic"&&r.type!=="cors")return r;var n=r.clone();return this.getRequestCache(t).then(i=>{P.set(this.network,"cacheRefresh",!0),i.put(t,n)}),r}getRequestCache(t){let r=t.headers.get("Accept")==="application/json"?this.cx.params.cache_name+"_json":this.cx.params.cache_name;return self.caches.open(r)}handleResponse(t,r){return r instanceof Ce||(r=Ce.compat(r)),r}};async function Vr(e=null){let t=this||{},r=n=>new ke(n);return new Be(Fe.create(t),(...n)=>e?e(...n.concat(r)):r(...n))}var _i={},xi={cache_name:"cache_v0",default_fetching_strategy:"network-first",network_first_urls:[],cache_first_urls:[],network_only_urls:[],cache_only_urls:[],skip_waiting:!1,support_push:!1,push_registration_url:"",push_deregistration_url:"",push_public_key:"",routing:{root:"/",subroots:[],targets:5}};Vr.call({layout:_i,params:xi});
})();
