/** @webqit/webflo */(async () => {
var Cr=Object.defineProperty;var Rr=(t,e)=>()=>(t&&(e=t(t=0)),e);var Ar=(t,e)=>{for(var r in e)Cr(t,r,{get:e[r],enumerable:!0})};var Zt={};Ar(Zt,{URLPattern:()=>Xt});function Hr(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function Dt(t,e=!1){let r=[],n=0;for(;n<t.length;){let i=t[n],s=function(o){if(!e)throw new TypeError(o);r.push({type:"INVALID_CHAR",index:n,value:t[n++]})};if(i==="*"){r.push({type:"ASTERISK",index:n,value:t[n++]});continue}if(i==="+"||i==="?"){r.push({type:"MODIFIER",index:n,value:t[n++]});continue}if(i==="\\"){r.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});continue}if(i==="{"){r.push({type:"OPEN",index:n,value:t[n++]});continue}if(i==="}"){r.push({type:"CLOSE",index:n,value:t[n++]});continue}if(i===":"){let o="",a=n+1;for(;a<t.length;){let f=t.substr(a,1);if(a===n+1&&Dr.test(f)||a!==n+1&&Ur.test(f)){o+=t[a++];continue}break}if(!o){s(`Missing parameter name at ${n}`);continue}r.push({type:"NAME",index:n,value:o}),n=a;continue}if(i==="("){let o=1,a="",f=n+1,u=!1;if(t[f]==="?"){s(`Pattern cannot start with "?" at ${f}`);continue}for(;f<t.length;){if(!Hr(t[f],!1)){s(`Invalid character '${t[f]}' at ${f}.`),u=!0;break}if(t[f]==="\\"){a+=t[f++]+t[f++];continue}if(t[f]===")"){if(o--,o===0){f++;break}}else if(t[f]==="("&&(o++,t[f+1]!=="?")){s(`Capturing groups are not allowed at ${f}`),u=!0;break}a+=t[f++]}if(u)continue;if(o){s(`Unbalanced pattern at ${n}`);continue}if(!a){s(`Missing pattern at ${n}`);continue}r.push({type:"PATTERN",index:n,value:a}),n=f;continue}r.push({type:"CHAR",index:n,value:t[n++]})}return r.push({type:"END",index:n,value:""}),r}function Ut(t,e={}){let r=Dt(t),{prefixes:n="./"}=e,i=`[^${pe(e.delimiter||"/#?")}]+?`,s=[],o=0,a=0,f="",u=new Set,c=x=>{if(a<r.length&&r[a].type===x)return r[a++].value},l=()=>{let x=c("MODIFIER");return x||c("ASTERISK")},p=x=>{let A=c(x);if(A!==void 0)return A;let{type:v,index:I}=r[a];throw new TypeError(`Unexpected ${v} at ${I}, expected ${x}`)},h=()=>{let x="",A;for(;A=c("CHAR")||c("ESCAPED_CHAR");)x+=A;return x},L=x=>x,R=e.encodePart||L;for(;a<r.length;){let x=c("CHAR"),A=c("NAME"),v=c("PATTERN");if(!A&&!v&&c("ASTERISK")&&(v=".*"),A||v){let b=x||"";n.indexOf(b)===-1&&(f+=b,b=""),f&&(s.push(R(f)),f="");let F=A||o++;if(u.has(F))throw new TypeError(`Duplicate name '${F}'.`);u.add(F),s.push({name:F,prefix:R(b),suffix:"",pattern:v||i,modifier:l()||""});continue}let I=x||c("ESCAPED_CHAR");if(I){f+=I;continue}if(c("OPEN")){let b=h(),F=c("NAME")||"",$=c("PATTERN")||"";!F&&!$&&c("ASTERISK")&&($=".*");let $e=h();p("CLOSE");let Tt=l()||"";if(!F&&!$&&!Tt){f+=b;continue}if(!F&&!$&&!b)continue;f&&(s.push(R(f)),f=""),s.push({name:F||($?o++:""),pattern:F&&!$?i:$,prefix:R(b),suffix:R($e),modifier:Tt});continue}f&&(s.push(R(f)),f=""),p("END")}return s}function pe(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function Ht(t){return t&&t.sensitive?"u":"ui"}function Mr(t,e){if(!e)return t;let r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(t.source);for(;i;)e.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(t.source);return t}function Wr(t,e,r){let n=t.map(i=>Wt(i,e,r).source);return new RegExp(`(?:${n.join("|")})`,Ht(r))}function qr(t,e,r){return Mt(Ut(t,r),e,r)}function Mt(t,e,r={}){let{strict:n=!1,start:i=!0,end:s=!0,encode:o=c=>c}=r,a=`[${pe(r.endsWith||"")}]|$`,f=`[${pe(r.delimiter||"/#?")}]`,u=i?"^":"";for(let c of t)if(typeof c=="string")u+=pe(o(c));else{let l=pe(o(c.prefix)),p=pe(o(c.suffix));if(c.pattern)if(e&&e.push(c),l||p)if(c.modifier==="+"||c.modifier==="*"){let h=c.modifier==="*"?"?":"";u+=`(?:${l}((?:${c.pattern})(?:${p}${l}(?:${c.pattern}))*)${p})${h}`}else u+=`(?:${l}(${c.pattern})${p})${c.modifier}`;else c.modifier==="+"||c.modifier==="*"?u+=`((?:${c.pattern})${c.modifier})`:u+=`(${c.pattern})${c.modifier}`;else u+=`(?:${l}${p})${c.modifier}`}if(s)n||(u+=`${f}?`),u+=r.endsWith?`(?=${a})`:"$";else{let c=t[t.length-1],l=typeof c=="string"?f.indexOf(c[c.length-1])>-1:c===void 0;n||(u+=`(?:${f}(?=${a}))?`),l||(u+=`(?=${f}|${a})`)}return new RegExp(u,Ht(r))}function Wt(t,e,r){return t instanceof RegExp?Mr(t,e):Array.isArray(t)?Wr(t,e,r):qr(t,e,r)}function Gr(t,e){return t.length?t[0]==="/"?!0:!e||t.length<2?!1:(t[0]=="\\"||t[0]=="{")&&t[1]=="/":!1}function qt(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function Vr(t,e){return t.endsWith(e)?t.substr(0,t.length-e.length):t}function zt(t){return!t||t.length<2?!1:t[0]==="["||(t[0]==="\\"||t[0]==="{")&&t[1]==="["}function Gt(t){if(!t)return!0;for(let e of Bt)if(t.test(e))return!0;return!1}function Qr(t,e){if(t=qt(t,"#"),e||t==="")return t;let r=new URL("https://example.com");return r.hash=t,r.hash?r.hash.substring(1,r.hash.length):""}function Kr(t,e){if(t=qt(t,"?"),e||t==="")return t;let r=new URL("https://example.com");return r.search=t,r.search?r.search.substring(1,r.search.length):""}function Jr(t,e){return e||t===""?t:zt(t)?Kt(t):Qt(t)}function Xr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.password=t,r.password}function Zr(t,e){if(e||t==="")return t;let r=new URL("https://example.com");return r.username=t,r.username}function Yr(t,e,r){if(r||t==="")return t;if(e&&!Bt.includes(e))return new URL(`${e}:${t}`).pathname;let n=t[0]=="/";return t=new URL(n?t:"/-"+t,"https://example.com").pathname,n||(t=t.substring(2,t.length)),t}function en(t,e,r){return Vt(e)===t&&(t=""),r||t===""?t:Jt(t)}function tn(t,e){return t=Vr(t,":"),e||t===""?t:yt(t)}function Vt(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function yt(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError(`Invalid protocol '${t}'.`)}function rn(t){if(t==="")return t;let e=new URL("https://example.com");return e.username=t,e.username}function nn(t){if(t==="")return t;let e=new URL("https://example.com");return e.password=t,e.password}function Qt(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError(`Invalid hostname '${t}'`);let e=new URL("https://example.com");return e.hostname=t,e.hostname}function Kt(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError(`Invalid IPv6 hostname '${t}'`);return t.toLowerCase()}function Jt(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError(`Invalid port '${t}'.`)}function sn(t){if(t==="")return t;let e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function on(t){return t===""?t:new URL(`data:${t}`).pathname}function an(t){if(t==="")return t;let e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function fn(t){if(t==="")return t;let e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}function $t(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");let r=new URL(t,e);return{protocol:r.protocol.substring(0,r.protocol.length-1),username:r.username,password:r.password,hostname:r.hostname,port:r.port,pathname:r.pathname,search:r.search!=""?r.search.substring(1,r.search.length):void 0,hash:r.hash!=""?r.hash.substring(1,r.hash.length):void 0}}function Ce(t,e,r){let n;if(typeof e.baseURL=="string")try{n=new URL(e.baseURL),t.protocol=n.protocol?n.protocol.substring(0,n.protocol.length-1):"",t.username=n.username,t.password=n.password,t.hostname=n.hostname,t.port=n.port,t.pathname=n.pathname,t.search=n.search?n.search.substring(1,n.search.length):"",t.hash=n.hash?n.hash.substring(1,n.hash.length):""}catch{throw new TypeError(`invalid baseURL '${e.baseURL}'.`)}if(typeof e.protocol=="string"&&(t.protocol=tn(e.protocol,r)),typeof e.username=="string"&&(t.username=Zr(e.username,r)),typeof e.password=="string"&&(t.password=Xr(e.password,r)),typeof e.hostname=="string"&&(t.hostname=Jr(e.hostname,r)),typeof e.port=="string"&&(t.port=en(e.port,t.protocol,r)),typeof e.pathname=="string"){if(t.pathname=e.pathname,n&&!Gr(t.pathname,r)){let i=n.pathname.lastIndexOf("/");i>=0&&(t.pathname=n.pathname.substring(0,i+1)+t.pathname)}t.pathname=Yr(t.pathname,t.protocol,r)}return typeof e.search=="string"&&(t.search=Kr(e.search,r)),typeof e.hash=="string"&&(t.hash=Qr(e.hash,r)),t}function Re(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function ln(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function pn(t,e){let r=".*",n=`[^${ln(e.delimiter||"/#?")}]+?`,i=/[$_\u200C\u200D\p{ID_Continue}]/u,s="";for(let o=0;o<t.length;++o){let a=t[o],f=o>0?t[o-1]:null,u=o<t.length-1?t[o+1]:null;if(typeof a=="string"){s+=Re(a);continue}if(a.pattern===""){if(a.modifier===""){s+=Re(a.prefix);continue}s+=`{${Re(a.prefix)}}${a.modifier}`;continue}let c=typeof a.name!="number",l=e.prefixes!==void 0?e.prefixes:"./",p=a.suffix!==""||a.prefix!==""&&(a.prefix.length!==1||!l.includes(a.prefix));if(!p&&c&&a.pattern===n&&a.modifier===""&&u&&!u.prefix&&!u.suffix)if(typeof u=="string"){let h=u.length>0?u[0]:"";p=i.test(h)}else p=typeof u.name=="number";if(!p&&a.prefix===""&&f&&typeof f=="string"&&f.length>0){let h=f[f.length-1];p=l.includes(h)}p&&(s+="{"),s+=Re(a.prefix),c&&(s+=`:${a.name}`),a.pattern===r?!c&&(!f||typeof f=="string"||f.modifier||p||a.prefix!=="")?s+="*":s+=`(${r})`:a.pattern===n?c||(s+=`(${n})`):s+=`(${a.pattern})`,a.pattern===n&&c&&a.suffix!==""&&i.test(a.suffix[0])&&(s+="\\"),s+=Re(a.suffix),p&&(s+="}"),s+=a.modifier}return s}var Dr,Ur,V,zr,Br,Bt,un,cn,G,Xt,Yt=Rr(()=>{Dr=/[$_\p{ID_Start}]/u,Ur=/[$_\u200C\u200D\p{ID_Continue}]/u;V={delimiter:"",prefixes:"",sensitive:!0,strict:!0},zr={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Br={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};Bt=["ftp","file","http","https","ws","wss"];un=class{constructor(t){this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=0,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=t}get result(){return this.internalResult}parse(){for(this.tokenList=Dt(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===0){this.rewind(),this.isHashPrefix()?this.changeState(9,1):this.isSearchPrefix()?(this.changeState(8,1),this.internalResult.hash=""):(this.changeState(7,0),this.internalResult.search="",this.internalResult.hash="");continue}else if(this.state===2){this.rewindAndSetState(5);continue}this.changeState(10,0);break}if(this.groupDepth>0)if(this.isGroupClose())this.groupDepth-=1;else continue;if(this.isGroupOpen()){this.groupDepth+=1;continue}switch(this.state){case 0:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(1));break;case 1:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();let t=7,e=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(t=2,e=3):this.shouldTreatAsStandardURL&&(t=2),this.changeState(t,e)}break;case 2:this.isIdentityTerminator()?this.rewindAndSetState(3):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(5);break;case 3:this.isPasswordPrefix()?this.changeState(4,1):this.isIdentityTerminator()&&this.changeState(5,1);break;case 4:this.isIdentityTerminator()&&this.changeState(5,1);break;case 5:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(6,1):this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 6:this.isPathnameStart()?this.changeState(7,0):this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 7:this.isSearchPrefix()?this.changeState(8,1):this.isHashPrefix()&&this.changeState(9,1);break;case 8:this.isHashPrefix()&&this.changeState(9,1);break;case 9:break;case 10:break}}}changeState(t,e){switch(this.state){case 0:break;case 1:this.internalResult.protocol=this.makeComponentString();break;case 2:break;case 3:this.internalResult.username=this.makeComponentString();break;case 4:this.internalResult.password=this.makeComponentString();break;case 5:this.internalResult.hostname=this.makeComponentString();break;case 6:this.internalResult.port=this.makeComponentString();break;case 7:this.internalResult.pathname=this.makeComponentString();break;case 8:this.internalResult.search=this.makeComponentString();break;case 9:this.internalResult.hash=this.makeComponentString();break;case 10:break}this.changeStateWithoutSettingComponent(t,e)}changeStateWithoutSettingComponent(t,e){this.state=t,this.componentStart=this.tokenIndex+e,this.tokenIndex+=e,this.tokenIncrement=0}rewind(){this.tokenIndex=this.componentStart,this.tokenIncrement=0}rewindAndSetState(t){this.rewind(),this.state=t}safeToken(t){return t<0&&(t=this.tokenList.length-t),t<this.tokenList.length?this.tokenList[t]:this.tokenList[this.tokenList.length-1]}isNonSpecialPatternChar(t,e){let r=this.safeToken(t);return r.value===e&&(r.type==="CHAR"||r.type==="ESCAPED_CHAR"||r.type==="INVALID_CHAR")}isProtocolSuffix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}nextIsAuthoritySlashes(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")}isIdentityTerminator(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")}isPasswordPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPortPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,":")}isPathnameStart(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")}isSearchPrefix(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;let t=this.safeToken(this.tokenIndex-1);return t.type!=="NAME"&&t.type!=="PATTERN"&&t.type!=="CLOSE"&&t.type!=="ASTERISK"}isHashPrefix(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")}isGroupOpen(){return this.tokenList[this.tokenIndex].type=="OPEN"}isGroupClose(){return this.tokenList[this.tokenIndex].type=="CLOSE"}isIPv6Open(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")}isIPv6Close(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")}makeComponentString(){let t=this.tokenList[this.tokenIndex],e=this.safeToken(this.componentStart).index;return this.input.substring(e,t.index)}computeShouldTreatAsStandardURL(){let t={};Object.assign(t,V),t.encodePart=yt;let e=Wt(this.makeComponentString(),void 0,t);this.shouldTreatAsStandardURL=Gt(e)}},cn=["protocol","username","password","hostname","port","pathname","search","hash"],G="*";Xt=class{constructor(t={},e){this.regexp={},this.keys={},this.component_pattern={};try{if(typeof t=="string"){let i=new un(t);if(i.parse(),t=i.result,e)if(typeof e=="string")t.baseURL=e;else throw new TypeError("'baseURL' parameter is not of type 'string'.");else if(typeof t.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(e)throw new TypeError("parameter 1 is not of type 'string'.");if(!t||typeof t!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");let r={pathname:G,protocol:G,username:G,password:G,hostname:G,port:G,search:G,hash:G};this.pattern=Ce(r,t,!0),Vt(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");let n;for(n of cn){if(!(n in this.pattern))continue;let i={},s=this.pattern[n];switch(this.keys[n]=[],n){case"protocol":Object.assign(i,V),i.encodePart=yt;break;case"username":Object.assign(i,V),i.encodePart=rn;break;case"password":Object.assign(i,V),i.encodePart=nn;break;case"hostname":Object.assign(i,zr),zt(s)?i.encodePart=Kt:i.encodePart=Qt;break;case"port":Object.assign(i,V),i.encodePart=Jt;break;case"pathname":Gt(this.regexp.protocol)?(Object.assign(i,Br),i.encodePart=sn):(Object.assign(i,V),i.encodePart=on);break;case"search":Object.assign(i,V),i.encodePart=an;break;case"hash":Object.assign(i,V),i.encodePart=fn;break}try{let o=Ut(s,i);this.regexp[n]=Mt(o,this.keys[n],i),this.component_pattern[n]=pn(o,i)}catch{throw new TypeError(`invalid ${n} pattern '${this.pattern[n]}'.`)}}}catch(r){throw new TypeError(`Failed to construct 'URLPattern': ${r.message}`)}}test(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return!1;try{typeof t=="object"?r=Ce(r,t,!1):r=Ce(r,$t(t,e),!1)}catch{return!1}let n;for(n in this.pattern)if(!this.regexp[n].exec(r[n]))return!1;return!0}exec(t={},e){let r={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof t!="string"&&e)throw new TypeError("parameter 1 is not of type 'string'.");if(typeof t>"u")return;try{typeof t=="object"?r=Ce(r,t,!1):r=Ce(r,$t(t,e),!1)}catch{return null}let n={};e?n.inputs=[t,e]:n.inputs=[t];let i;for(i in this.pattern){let s=this.regexp[i].exec(r[i]);if(!s)return null;let o={};for(let[a,f]of this.keys[i].entries())if(typeof f.name=="string"||typeof f.name=="number"){let u=s[a+1];o[f.name]=u}n[i]={input:r[i]||"",groups:o}}return n}get protocol(){return this.component_pattern.protocol}get username(){return this.component_pattern.username}get password(){return this.component_pattern.password}get hostname(){return this.component_pattern.hostname}get port(){return this.component_pattern.port}get pathname(){return this.component_pattern.pathname}get search(){return this.component_pattern.search}get hash(){return this.component_pattern.hash}};globalThis.URLPattern||(globalThis.URLPattern=Xt)});var xe=class{constructor(e,r=null){Object.defineProperty(this,"dict",{value:Object.create(e)});for(let n in this.dict)n in this||(this[n]=this.dict[n]);arguments.length>1&&Object.defineProperty(this.dict,"CWD",{get:()=>r})}get name(){return"webflo"}static create(...e){return new this(...e)}get CWD(){return this.dict.CWD||""}get meta(){return this.dict.meta||{}}get app(){return this.dict.app||{}}get config(){return this.dict.config||{}}get flags(){return this.dict.flags||{}}set flags(e){this.dict.flags=e}get layout(){return this.dict.layout||{}}set layout(e){this.dict.layout=e}get logger(){return this.dict.logger}set logger(e){this.dict.logger=e}};var we=class extends xe{};var be=class extends we{};function d(t){return!Array.isArray(t)&&typeof t=="object"&&t}function C(t){return typeof t}function w(t,...e){globalThis.WebQitInternalsRegistry||(globalThis.WebQitInternalsRegistry=new Map);var r=globalThis.WebQitInternalsRegistry.get(t);if(!r){if(r=new Map,e[0]===!1)return r;globalThis.WebQitInternalsRegistry.set(t,r)}for(var n,i;n=e.shift();)if((i=r)&&!(r=r.get(n))){if(r=new Map,e[0]===!1)return r;i.set(n,r)}return r}function m(t){return Array.isArray(t)}function ee(t){return typeof t=="function"}function ct(t){return ee(t)&&/^class\s?/.test(Function.prototype.toString.call(t))}function De(t){return t===null||t===""}function D(t){return arguments.length&&(t===void 0||typeof t>"u")}function g(t){return Array.isArray(t)||typeof t=="object"&&t||ee(t)}function fe(t){return De(t)||D(t)||t===!1||t===0||g(t)&&!Object.keys(t).length}function y(t){return ee(t)||t&&{}.toString.call(t)==="[object function]"}function q(t){return t instanceof Number||typeof t=="number"}function O(t){return q(t)||t!==!0&&t!==!1&&t!==null&&t!==""&&!isNaN(t*1)}function lt(t){return m(t)&&Object.getPrototypeOf(t)===Array.prototype}function Ue(t){return d(t)&&Object.getPrototypeOf(t)===Object.prototype}function j(t){return t instanceof String||typeof t=="string"&&t!==null}function pt(t){return!j(t)&&!D(t.length)}function ve(t,e=1){var r=0;t.forEach(i=>{r++});var n=t.slice(t.length-r,e);return arguments.length>1?n:n[0]}function Oe(t,e=1){return arguments.length>1?ve(t.slice().reverse(),e).reverse():ve(t.slice().reverse())}function He(t,...e){return e.forEach(r=>{t.indexOf(r)<0&&t.push(r)}),t}function ht(n,e){e=e||Object.prototype,e=e&&!m(e)?[e]:e;for(var r=[],n=n;n&&(!e||e.indexOf(n)<0)&&n.name!=="default";)r.push(n),n=n?Object.getPrototypeOf(n):null;return r}function mt(t,e){var r=[];return ht(t,e).forEach(n=>{He(r,...Object.getOwnPropertyNames(n))}),r}function H(t,e,r=!1,n=!1,i=!1){var s=0,o=t.shift();if((O(o)||o===!0||o===!1)&&(s=o,o=t.shift()),!t.length)throw new Error("_merge() requires two or more array/objects.");return t.forEach((a,f)=>{!g(a)&&!y(a)||(r?mt(a):Object.keys(a)).forEach(u=>{if(!!e(u,o,a,f)){var c=o[u],l=a[u];if((m(c)&&m(l)||d(c)&&d(l))&&(s===!0||s>0))o[u]=m(c)&&m(l)?[]:{},H([O(s)?s-1:s,o[u],c,l],e,r,n,i);else if(m(o)&&m(a))n?o[u]=l:o.push(l);else try{i?Object.defineProperty(o,u,Object.getOwnPropertyDescriptor(a,u)):o[u]=a[u]}catch{}}})}),o}function W(t,e){var r=void 0;return g(t)&&Object.keys(t).forEach((n,i)=>{r!==!1&&(r=e(O(n)?parseFloat(n):n,t[n],i))}),r}function te(...t){return H(t,(e,r,n)=>!0,!1,!1,!1)}function z(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?"":t.substr(n+e.length)}function dt(t,e){return z(t,e,!0)}function ue(t,e,r=!1){if(e=="")return t;var n=r?t.lastIndexOf(e):t.indexOf(e);return n===-1?t:t.substr(0,n)}function re(t,e){return ue(t,e,!0)}function ce(t,e,r=null,n=!1){return e.length>t.length?-1:(typeof r=="number"?n?t.slice(0,r+1+(r<0?t.length:0)):t.slice(r):t).reduce((i,s,o)=>{var[a,f,u]=i;if(!n&&a>-1)return[a,f,u];var c=u+1,l=s===e[c]?c===0?[o,0]:[f,c]:[-1,-1];return l[1]===e.length-1&&(l[1]=-1,l[0]>-1)?[l[0]].concat(l):[a].concat(l)},[-1,-1,-1])[0]+(n||typeof r!="number"?0:r>-1?r:t.length-r)}function le(t,e,r=null,n=!1){var i=ce(t,e,r,n);return i===-1?[]:t.slice(i+e.length)}function Se(t,e){return t.reduce((r,n,i)=>r||e(n,i),!1)}function _(t,e=!0){return m(t)?t:!e&&d(t)?[t]:t!==!1&&t!==0&&fe(t)?[]:pt(t)?Array.prototype.slice.call(t):d(t)?Object.values(t):[t]}function B(t,e,r=null){return r||r!==!1&&t.dotSafe&&e.dotSafe?t.join(".")===e.join("."):t.length===e.length&&t.reduce((n,i,s)=>n&&i===e[s],!0)}function Pe(t,e,r=null){return m(e)?t.filter(n=>r?e.filter(i=>r(n,i)).length:e.indexOf(n)!==-1):[]}function Ee(t,e,r=null){return r||r!==!1&&t.dotSafe&&e.dotSafe?(t.join(".")+".").startsWith(e.join(".")+"."):e.reduce((n,i,s)=>n&&i===t[s],!0)}function gt(t){let e=(r,n,i)=>i.indexOf(r)===n;return t.filter(e)}typeof URLPattern>"u"&&await Promise.resolve().then(()=>(Yt(),Zt));function er(t,e,r,n=!1){if(j(e)&&e.endsWith("]")){var i=re(dt(e,"["),"]")||0;return O(i)&&(i=parseInt(i)),e=re(e,"[")||0,O(e)&&(e=parseInt(e)),er(t,e,(s,o)=>{if(!s[o]){if(!n)return r();s[o]=O(i)?[]:{}}return r(s[o],i)},n)}else return r(t,e)}function Me(t,e,r,n=!0){er(t,e,(i,s)=>{O(s)?(s=s||m(i)?i.length:Object.keys(i).filter(O).length,_(r,!1).forEach((o,a)=>{i[s+a]=o})):i[s]=n&&s in i?_(i[s],!1).concat(r):r},!0)}function ne(t,e={},r="&"){return t=t||"",(t.startsWith("?")?t.substr(1):t).split(r).filter(n=>n).map(n=>n.split("=").map(i=>i.trim())).forEach(n=>Me(e,n[0],decodeURIComponent(n[1]))),e}function We(t,e,r,n=null){if((d(e)||m(e))&&(!n||n(e,t))){var i=m(e);Object.keys(e).forEach(s=>{We(`${t}[${s}]`,e[s],r,n)})}else r(t,!e&&e!==0?"":e)}function qe(t,e="&",r=null){var n=[];return Object.keys(t).forEach(i=>{We(i,t[i],(s,o)=>{n.push(`${s}=${encodeURIComponent(o)}`)},r)}),n.join(e)}var tr={join(){for(var t=[],e=0,r=0,n=arguments.length;r<n;r++)t=t.concat(arguments[r].split("/"));var i=[];for(r=0,n=t.length;r<n;r++){var s=t[r];!s||s==="."||(s===".."?i.length?i.pop():e++:i.push(s))}return t[0]===""&&i.unshift(""),"../".repeat(e)+i.join("/")||(i.length?"/":".")},dirname(t){return this.join(t,"..")}},_t=(t,e=null)=>({pattern:new URLPattern(t,e),isPattern(){return Object.keys(this.pattern.keys||{}).some(r=>this.pattern.keys[r].length)},test(...r){return this.pattern.test(...r)},exec(...r){let n=this.pattern.exec(...r);if(!!n)return n.vars=Object.keys(this.pattern.keys).reduce(({named:i,unnamed:s},o)=>(this.pattern.keys[o].forEach(a=>{let f=n[o].groups[a.name];typeof a.name=="number"?s.push(f):i[a.name]=f}),{named:i,unnamed:s}),{named:{},unnamed:[]}),n.render=i=>i.replace(/\$(\$|[0-9A-Z]+)/gi,(s,o)=>o==="$"?"$":(O(o)?n.vars.unnamed[o-1]:n.vars.named[o])||""),n}});var Ae=class{constructor(e,r=[]){this.cx=e,this.path=m(r)?r:(r+"").split("/").filter(n=>n)}async route(e,r,n,i,s=null){let o=this,a=this.cx.runtime,f=async function(u){let c={runtime:a};if(!u.trail||u.trail.length<u.destination.length){if(u=await o.readTick(u),c.pathname=`/${u.trail.join("/")}`,c.stepname=u.trail[u.trail.length-1],o.finalizeHandlerContext(c,u),u.exports){u.exports.hints&&await r.port.post({...u.exports.hints,$type:"handler:hints"});let l=_(u.method),p=y(u.exports)&&l.includes("default")?u.exports:l.reduce((h,L)=>h||u.exports[L],null);if(p){let h=async(...R)=>{let x={...u,arg:R[0]};if(R.length>1){let v=R[1],I,N={...R[2]||{}};if(R[1]instanceof x.event.Request)I=R[1],v=I.url;else if(!j(v))throw new Error("Router redirect url must be a string!");var A=v.startsWith("/")?v:o.pathJoin(`/${u.trail.join("/")}`,v);if(A.startsWith("../"))throw new Error("Router redirect cannot traverse beyond the routing directory! ("+v+" >> "+A+")");N.method&&(x.method=N.method,m(N.method)&&(N.method=N.method[0])),I?x.event=u.event.with(A,I,N):x.event=u.event.with(A,N),x.source=u.destination.join("/"),x.destination=A.split("?").shift().split("/").map(b=>b.trim()).filter(b=>b),x.trail=R[1].startsWith("/")?[]:u.trail.reduce((b,F,$)=>b.length===$&&F===x.destination[$]?b.concat(F):b,[]),x.trailOnFile=u.trailOnFile.slice(0,x.trail.length)}return f(x)},L=u.destination.slice(u.trail.length);return h.pathname=L.join("/"),h.stepname=L[0],await p.call(c,u.event,u.arg,h,s)}return f(u)}else if((u.currentSegmentOnFile||{}).dirExists)return f(u)}if(i)return await i.call(c,u.event,u.arg,s)};return f({destination:this.path,event:r,method:e,arg:n})}};var je=class extends Ae{async readTick(e){var r=this.cx.layout,n=Object.keys(this.cx.layout);return e.trail?(e.currentSegment=e.destination[e.trail.length],e.currentSegmentOnFile=[e.currentSegment,"-"].reduce((i,s)=>{if(i.index)return i;var o=`/${e.trailOnFile.concat(s).join("/")}`;return r[o]?{seg:s,index:o}:n.filter(a=>a.startsWith(`${o}/`)).length?{seg:s,dirExists:!0}:i},{seg:null}),e.trail.push(e.currentSegment),e.trailOnFile.push(e.currentSegmentOnFile.seg),e.exports=r[e.currentSegmentOnFile.index]):(e.trail=[],e.trailOnFile=[],e.currentSegmentOnFile={index:"/"},e.exports=r["/"]),e}finalizeHandlerContext(e,r){return e.dirname=r.currentSegmentOnFile.index}pathJoin(...e){return tr.join(...e)}};var Te=class{constructor(e){this.cx=e}async init(e,r){return new this.Router(this.cx,"/").route(["init"],e,{},async i=>{},r)}};var ke=class extends Te{get Router(){return je}async handle(e,r){let n=new this.Router(this.cx,e.url.pathname);return(async()=>{let s=e.request.method.toUpperCase(),o=await n.route([s,"default"],e,{},async a=>r(a.request),r);return o instanceof e.Response||(o=e.Response.compat(o)),o})()}};function ie(t){return(xt(t)?t:_(t).length?[t]:[]).reduce((e,r)=>e.concat([_(r)]),[]).map(e=>Q.resolve(e))}var Q=class extends Array{static resolve(e){return e.every(r=>!(r+"").includes("."))?new Q().concat(e):e}get dotSafe(){return!0}};function xt(t){return _(t).reduce((e,r)=>e||m(r),!1)}function wt(t){return t.filter(e=>e||e===0).length!==t.length}function rr(t){return t.filter(e=>wt(_(e))).length>0}var se=class{constructor(e){this.target=e,this.fireables=[],this.currentlyFiring=[]}add(e){return this.fireables.push(e),e}remove(e){this.fireables=this.fireables.filter(r=>r!==e)}removeMatches(e){this.match(e).forEach(r=>{this.fireables=this.fireables.filter(n=>n!==r)})}match(e){return this.fireables.filter(r=>{var n=ie(r.filter),i=_((r.params||{}).tags),s=ie(e.filter),o=_((e.params||{}).tags);return(!e.originalHandler||r.handler===e.originalHandler)&&(!s.length||B(s,n))&&(!o.length||o.length===i.length&&Pe(i,o).length===o.length)})}static _getFirebase(e,r,n=!0,i=this.__namespace){if(!g(r))throw new Error('Subject must be of type object; "'+C(r)+'" given!');var s=this;return i&&globalThis.WebQitObserverNamespaceRegistry.has(e+"-"+i)&&(s=globalThis.WebQitObserverNamespaceRegistry.get(e+"-"+i),e+="-"+i),!w(r,"firebases").has(e)&&n&&w(r,"firebases").set(e,new s(r)),w(r,"firebases").get(e)}static _namespace(e,r,n=null){if(e+="-"+r,arguments.length===2)return globalThis.WebQitObserverNamespaceRegistry.get(e);if(!(n.prototype instanceof this))throw new Error(`The implementation of the namespace ${this.name}.${r} must be a subclass of ${this.name}.`);globalThis.WebQitObserverNamespaceRegistry.set(e,n),n.__namespace=r}};globalThis.WebQitObserverNamespaceRegistry||(globalThis.WebQitObserverNamespaceRegistry=new Map);var oe=class{constructor(e,r){this.target=e,this.handler=r.handler,this.filter=r.filter,this.params=r.params}disconnect(){this.disconnected=!0}};var Le=class extends oe{fire(e,r,n){return this.disconnected||this.filter&&!Pe(_(this.filter),[e.type]).length?r(...Array.prototype.slice.call(arguments,2)):this.handler(e,n,r)}};function ze(t,e=[],r=!0){var n=0;return O(arguments[0])&&g(arguments[1])&&(n=arguments[0],t=arguments[1],e=arguments[2]||[]),H([n,{},t],(i,s,o)=>y(e)?e(i):m(e)&&e.length?e.indexOf(i)>-1:!0,!1,!1,r)}var he=class{constructor(e,r){if(this.target=e,!r.type)throw new Error("Action type must be given in definition!");W(r,(n,i)=>{Object.defineProperty(this,n,{value:i,enumerable:!0})}),Object.seal(this)}};var T=class extends se{add(e){return super.add(new Le(this.target,e))}fire(e,r=null){if(e instanceof he||(e=new he(this.target,e)),this.currentlyFiring.filter(s=>s.type===e.type&&s.name===e.name).length)return r?r():void 0;this.currentlyFiring.push(e);let n=(s,...o)=>{var a=this.fireables[s];return a?a.fire(e,(...f)=>n(s+1,...f),...o):r?r(...o):o[0]};var i=n(0);return this.currentlyFiring.pop(),i}static getFirebase(e,r=!0,n=null){return super._getFirebase("interceptor",...arguments)}static namespace(e,r=null){return super._namespace("interceptor",...arguments)}};function E(t){return w(t,!1).get(t)||t}function k(t,e,r={},n={}){if(!e||!g(e))throw new Error("Target must be of type object!");e=E(e);var i,s=function(o){return arguments.length?o:Reflect[t](e,...Object.values(r))};return(i=T.getFirebase(e,!1,n.namespace))?i.fire({type:t,...r},s):s()}function Ge(t,e,r,n={}){return k("apply",t,{thisArgument:e,argumentsList:r},n)}function Ve(t,e,r=null,n={}){return k("construct",t,arguments.length>2?{argumentsList:e,newTarget:r}:{argumentsList:e},n)}var M=class{constructor(e,r=!1){this._={},this._.target=e,this._.cancellable=r,this._.propagationStopped=!1,this._.defaultPrevented=!1,this._.promisesInstance=null,this._.promises=[]}get target(){return this._.target}get cancellable(){return this._.cancellable}stopPropagation(){this._.propagationStopped=!0}get propagationStopped(){return this._.propagationStopped}preventDefault(){this._.defaultPrevented=!0}get defaultPrevented(){return this._.defaultPrevented}waitUntil(e){e instanceof Promise&&(this._.promises.push(e),this._.promisesInstance=null)}get promises(){return!this._.promisesInstance&&this._.promises.length&&(this._.promisesInstance=Promise.all(this._.promises)),this._.promisesInstance}respondWith(e){var r,n=d(e)&&!D(e.propagationStopped)&&!D(e.defaultPrevented);e===!1||n&&e.propagationStopped?this.stopPropagation():e===!1||n&&e.defaultPrevented?this.preventDefault():(e instanceof Promise&&(r=e)||n&&(r=e.promises))&&this.waitUntil(r)}};var Fe=class extends oe{constructor(e,r){if(super(e,r),this.filters2D=ie(this.filter),this.filtersIsOriginally2D=xt(this.filter),this.filtersIsDynamic=rr(this.filters2D),this.filtersIsDynamic&&this.filters2D.length>1)throw new Error('Only one "Dynamic Filter" must be observed at a time! "'+this.filters2D.map(n=>"["+n.join(", ")+"]").join(", ")+'" have been bound together.')}fire(e){if(this.disconnected||this.params.type&&!Se(e,o=>this.params.type===o.type))return;let r=o=>!["set","def"].includes(o.type)||!this.params.diff||(y(this.params.diff)?this.params.diff(o.value,o.oldValue):o.value!==o.oldValue);var n=new M(this.target);if(this.filters2D.length){var i=e.filter(o=>this.filters2D.filter((a,f)=>{var u=a.slice();return this.filtersIsDynamic&&o.path.forEach((c,l)=>{u[l]=u[l]||u[l]===0?u[l]:c}),(!this.filtersIsDynamic||!wt(u))&&r(o)&&(!this.params.subtree&&B(u,o.path)||this.params.suptree&&Ee(u,o.path)&&(!O(this.params.suptree)||le(u,o.path).length<=this.params.suptree)||this.params.subtree&&o.path.length>=u.length&&Ee(o.path,u)&&(!O(this.params.subtree)||le(o.path,u).length<=this.params.subtree))}).length);if(i.length)if(this.filtersIsOriginally2D||this.params.subtree){var s=i;d(this.filter)&&(s={...this.filter},i.forEach((o,a)=>{s[o.name]=o})),n.respondWith(this.handler(s,n))}else i.forEach((o,a)=>{n.respondWith(this.handler(o,n))})}else(this.params.subtree||e.filter(o=>B(o.path,[o.name])).length===e.length)&&e.filter(o=>r(o)).length&&n.respondWith(this.handler(e,n));return n}};var K=class{constructor(e,r){if(this.target=e,r.originalSubject||(this.originalSubject=e),!("type"in r))throw new Error("Mutation type must be given in definition!");if(!("name"in r))throw new Error("Property name must be given in definition!");W(r,(n,i)=>{n==="path"&&(i=Q.resolve(i)),Object.defineProperty(this,n,{value:i,enumerable:!0})}),this.path||Object.defineProperty(this,"path",{value:Q.resolve([r.name]),enumerable:!0}),Object.seal(this)}};var S=class extends se{constructor(e){super(e),this.buffers=[]}add(e){return super.add(new Fe(this.target,e))}fire(e,r){var n=new M(this.target,r);return e=_(e,!1).map(i=>i instanceof K?i:new K(this.target,i)),this.buffers.length?(Oe(this.buffers)(e),n):(this.currentlyFiring.filter(i=>e.filter(s=>i.type===s.type&&i.name===s.name).length).length,this.fireables.forEach(i=>{if(n.propagationStopped&&r)return n;n.respondWith(i.fire(e))}),n)}static getFirebase(e,r=!0,n=null){return super._getFirebase("observer",...arguments)}static namespace(e,r=null){return super._namespace("observer",...arguments)}};function U(t,e,r=null,n={}){if(t=r||t,!t||!g(t))throw new Error("Target must be of type object!");t=E(t);var i=_(e),s=i.map(o=>{var a,f=function(u){return arguments.length?u:w(t,"accessorizedProps").has(o)&&w(t,"accessorizedProps").get(o).touch(!0)?w(t,"accessorizedProps").get(o).get():r?Reflect.get(t,o,r):Reflect.get(t,o)};return(a=T.getFirebase(t,!0,n.namespace))?a.fire({type:"get",name:o,related:i,receiver:r},f):f()});return m(e)?s:s[0]}function Qe(t,e,r=null,n={}){if(t=E(t),!t||!g(t))throw new Error('Observable subjects must be of type object; "'+C(t)+'" given!');if(y(e)&&(n=arguments.length>2?r:{},r=e,e=null),!y(r))throw new Error('Handler must be a function; "'+C(r)+'" given!');var i,s=S.getFirebase(t,!0,n.namespace),o={filter:e,handler:r,params:n};if((o.filter||o.params.subtree==="*"||o.params.subtree&&me(t))&&J(t,o.filter,o.params.subtree,n.namespace),o.params.unique&&(i=s.match({filter:e,params:n})).length){if(o.params.unique!=="replace")return i[0];s.remove(i[0])}return s.add(o)}function X(t,e,r,n=null,i={}){if(t!==r){var s;if(Qe(r,(a,f)=>{if(s=S.getFirebase(t,!1,i.namespace)){var u=a.map(c=>{var l=c;do if(l.target===t)return;while(l=l.src);var p={};return W(c,(h,L)=>{h!=="target"&&h!=="name"&&h!=="path"&&h!=="src"&&(p[h]=L)}),p.name=e,p.path=[e].concat(c.path),p.originalSubject=c.originalSubject,p.src=c,new K(t,p)}).filter(c=>c);if(u.length)return s.fire(u,f.cancellable)}},{subtree:!0,...i,unique:!0,tags:[vt,e,t]}),d(n)&&(s=S.getFirebase(t,!1,i.namespace))){var o=te({name:e,type:"set",value:r,related:[e]},n);let a=s.fire(o,i.cancellable);if(i.eventTypeReturn)return a}}}var vt={};function J(t,e=null,r=!1,n=null){if(!t||!g(t))throw new Error("Target must be of type object!");var i=S.getFirebase(t,!0,n);if(!(!i||i.build)){i.build=r;var s=ie(e),o=!s.length||s.filter(f=>!f[0]&&f[0]!==0).length?Object.keys(t):s.map(f=>f[0]),a=s.length?s.map(f=>f.slice(1)).filter(f=>f.length):null;i.subBuild=a&&a.length?a:null,o.forEach(f=>{var u=U(t,f,null,{namespace:n});try{g(u)&&(X(t,f,u,null,params),(i.subBuild&&me(u)||(_isFunction(r)?r(u):r&&me(u)))&&J(u,i.subBuild,r,n))}catch{}})}}var me=t=>(t instanceof Object||t instanceof Array||t instanceof Function)&&(typeof window>"u"||t!==window);function Ke(t,e,r=null,n={}){if(t=E(t),!t||!g(t))throw new Error('Observable subjects must be of type object; "'+C(t)+'" given!');if(y(e)&&(n=arguments.length>2?r:{},r=e,e=null),r&&!y(r))throw new Error('Handler must be a function; "'+C(r)+'" given!');var i;if(i=S.getFirebase(t,!1,n.namespace))return i.removeMatches({filter:e,originalHandler:r,params:n})}function Z(t,e,r,n=null,i={}){Ke(r,null,null,{...i,tags:[vt,e,t]});var s;if(d(n)&&(s=S.getFirebase(t,!1,i.namespace))){var o=te({name:e,type:"del",oldValue:r,related:[e]},n);s.fire(o,i.cancellable)}}function Y(t,e,r={}){return k("has",t,{name:e},r)}function Je(t,e,r,n={}){e=r.receiver||e;var i=r.keysOrPayload,s=r.value;if(!e||!g(e))throw new Error("Target must be of type object!");d(i)&&(n=s||{},s=null),e=E(e);var o=T.getFirebase(e,!1,n.namespace),a=S.getFirebase(e,!1,n.namespace);let f=(h,L,R,x)=>{var A="set",v;t&&(A="defineProperty",v=L||{},L=v.value);var I=!1,N;Y(e,h,n)&&(I=!0,N=U(e,h,r.receiver,n));var b={name:h,type:A,value:L,receiver:r.receiver,related:R,detail:x,isUpdate:I,oldValue:N},F=function($e){return arguments.length&&(v?v=$e:L=$e),v?w(e,"accessorizedProps",!1).has(h)&&!w(e,"accessorizedProps").get(h).restore()?!1:(Object.defineProperty(e,h,v),!0):w(e,"accessorizedProps",!1).has(h)?w(e,"accessorizedProps").get(h).set(L):(e[h]=L,!0)};if(o){var $=v?{type:"defineProperty",name:h,descriptor:v,receiver:r.receiver,related:R,detail:x,isUpdate:I,oldValue:N}:{type:"set",name:h,value:L,receiver:r.receiver,related:R,detail:x,isUpdate:I,oldValue:N};b.success=o.fire($,F)}else b.success=F();return b.success&&b.value!==b.oldValue&&(g(b.oldValue)&&Z(e,h,b.oldValue,null,n),g(b.value)&&(X(e,h,b.value,null,n),a&&(a.subBuild||a.build&&me(b.value))&&J(b.value,a.subBuild,a.build,n.namespace))),b};var u,c=[];m(i)||(j(i)||q(i))&&(u=_(i))?c=u.map(h=>f(h,s,u,n.detail)):d(i)&&(u=Object.keys(i))&&(c=u.map(h=>f(h,i[h],u,n.detail)));var l=c.filter(h=>h.success!==!1),p;return a?(p=a.fire(l,n.cancellable),p.successCount=l.length):n.eventTypeReturn&&(p=new M(e)),n.eventTypeReturn?p:l.length>0}function Xe(t,e,r=null,n={}){return Je(!0,t,{keysOrPayload:e,value:r},n)}function Ze(t,e,r={}){if(!t||!g(t))throw new Error("Target must be of type object!");t=E(t);var n=_(e),i=n.map(f=>{var u;Y(t,f,r)&&(u=U(t,f,null,r));var c={name:f,type:"deleteProperty",related:n,detail:r.detail,oldValue:u},l,p=function(h){return arguments.length?h:w(t,"accessorizedProps",!1).has(f)&&!w(t,"accessorizedProps").get(f).restore()?!1:(delete t[f],!0)};return(l=T.getFirebase(t,!1,r.namespace))?c.success=l.fire({type:"deleteProperty",name:f,oldValue:u,related:n},p):c.success=p(),c.success&&g(c.oldValue)&&Z(t,f,c.oldValue,null,r),c}),s=i.filter(f=>f.success!==!1),o,a;return(o=S.getFirebase(t,!1,r.namespace))?(a=o.fire(s,r.cancellable),a.successCount=s.length):r.eventTypeReturn&&(a=new M(t)),r.eventTypeReturn?a:s.length>0}function Ye(t,e,r={}){return k("getOwnPropertyDescriptor",t,{name:e},r)}function et(t,e={}){return k("getPrototypeOf",t,{},e)}function tt(t,e={}){return k("isExtensible",t,{},e)}function rt(t,e={}){return k("ownKeys",t,{},e)}function nt(t,e={}){return k("preventExtensions",t,{},e)}function de(t,e,r=null,n=null,i={}){return Je(!1,t,arguments.length>3?{keysOrPayload:e,value:r,receiver:n}:{keysOrPayload:e,value:r},i)}function it(t,e,r={}){return k("setPrototypeOf",t,{prototype:e},r)}function nr(t,e=[],r={}){r=d(e)?e:r;var n=(arguments.length===1?Object.keys(t):_(e)).map(i=>{if(w(t,"accessorizedProps").has(i)&&w(t,"accessorizedProps").get(i).touch(!0))return!1;let s=()=>{for(var p,h=t;!p&&(h=Object.getPrototypeOf(h));)p=Object.getOwnPropertyDescriptor(h,i);return p};var o=Object.getOwnPropertyDescriptor(t,i),a,f;o||(a={writable:!0,enumerable:!(i in t),configurable:r.configurable!==!1});var u={...o||a};"value"in u&&delete u.value,"writable"in u&&delete u.writable,u.get=()=>{if(l.ongoingGets.length)return l.get();l.ongoingGets.push(1);var p=U(t,i,null,r);return l.ongoingGets.pop(),p};var c;u.set=p=>{if(l.ongoingSets.length)return l.set(p);l.ongoingSets.push(1);var h=de(t,i,p,null,r);return l.ongoingSets.pop(),h};var l={ongoingGets:[],ongoingSets:[],get:function(){var p=o;return p||(f?p=a:p=s()||a),p.get?p.get.call(t):p.value},set:function(p){var h=o;return h||(f?h=a:(h=s())?"value"in h&&(h=a,f=!0):(h=a,f=!0)),h.set||h.get?h.set?h.set.call(t,p):!1:(h.value=p,!0)},restore:function(){try{return this.intact()&&(o||f?Object.defineProperty(t,i,o||a):delete t[i],w(t,"accessorizedProps").delete(i)),!0}catch{}return!1},intact:function(){return(Object.getOwnPropertyDescriptor(t,i)||{}).get===u.get},touch:function(p=!1){return this.intact()||(p?!this.restore():!1)}};try{return Object.defineProperty(t,i,u),w(t,"accessorizedProps").set(i,l),!0}catch{}return!1});return m(e)?n:n[0]}function ir(t,e=[],r={}){r=d(e)?e:r;var n=(arguments.length===1?Object.keys(t):_(e)).map(i=>w(t,"accessorizedProps",!1).has(i)?w(t,"accessorizedProps").get(i).restore():!0);return m(e)?n:n[0]}function sr(t,e={}){if(!g(t))throw new Error('Object must be of type target; "'+C(t)+'" given!');var r=new Proxy(t,{apply:(n,i,s)=>Ge(n,i,s,e),construct:(n,i,s=null)=>Ve(n,i,s,e),defineProperty:(n,i,s)=>Xe(n,i,s,e),deleteProperty:(n,i)=>Ze(n,i,e),get:(n,i,s=null)=>{var o=U(n,i,s,e);return e.proxyAutoBinding!==!1&&y(o)&&!ct(o)?o.bind(r):o},getOwnPropertyDescriptor:(n,i)=>Ye(n,i,e),getPrototypeOf:n=>et(n,e),has:(n,i)=>Y(n,i,e),isExtensible:n=>tt(n,e),ownKeys:n=>rt(n,e),preventExtensions:n=>nt(n,e),set:(n,i,s,o=null)=>de(n,i,s,o,e),setPrototypeOf:(n,i)=>it(n,i,e)});return w(r).set(r,t),r}function or(t,e,r={}){if(t=E(t),!g(t))throw new Error('Object must be of type target; "'+C(handler)+'" given!');var n={},i=!0;d(e)||(y(e)?e={"":e}:y(r)&&(e={[e]:r},r=arguments.length>3?arguments[3]:{}),i=!1);var s=T.getFirebase(t,!0,r.namespace);return Object.keys(e).forEach(o=>{if(!y(e[o]))throw new Error("Callback"+(o===null?"":" for "+o)+' must be a function; "'+C(e[o])+'" given!');var a={filter:o,handler:e[o],params:r},f;if(a.params.unique&&(f=s.match(a)).length){if(a.params.unique!=="replace")return f[0];s.remove(f[0])}i?n[o]=s.add(a):n=s.add(a)}),n}function ar(t,e=null,r={}){if(t=E(t),!t||!g(t))throw new Error('Object must be of type target; "'+C(t)+'" given!');var n=T.getFirebase(t,!1,r.namespace);_isObject(e)||(y(e)?e={[null]:e}:y(r)&&(e={[e]:r},r=arguments.length>3?arguments[3]:{}),isOriginallyObj=!1),(n=T.getFirebase(t,!1,r.namespace))&&Object.keys(e).forEach(i=>{if(!y(e[i]))throw new Error("Callback"+(i===null?"":" for "+i)+' must be a function; "'+C(e[i])+'" given!');var s={filter:i,originalHandler:e[i],params:r};return n.removeMatches(s)})}function fr(t,...e){var r=e.map(s=>{if(s=E(s),!g(s))throw new Error("Target must be of type object!");return{target:s,subjectCopy:m(s)?s.slice(0):ze(s)}}),n=t(...e);let i=()=>{r.map(s=>{var o=Object.keys(s.subjectCopy),a=Object.keys(s.target),f=[],u=gt(o.concat(a)).map(l=>{if(s.subjectCopy[l]!==s.target[l]){f.push(l);var p={name:l,related:f,buffered:!0};return a.includes(l)?(p.type="set",p.value=s.target[l],o.includes(l)&&(p.isUpdate=!0)):p.type="del",o.includes(l)&&(p.oldValue=s.subjectCopy[l]),g(s.subjectCopy[l])&&Z(s.target,l,s.subjectCopy[l]),g(s.target[l])&&X(s.target,l,s.target[l]),p}}).filter(l=>l),c;if(u.length&&(c=S.getFirebase(s.target,!1)))return c.fire(u)})};return n instanceof Promise?n.then(i):i(),n}var P={apply:Ge,construct:Ve,defineProperty:Xe,deleteProperty:Ze,get:U,getOwnPropertyDescriptor:Ye,getPrototypeOf:et,has:Y,isExtensible:tt,ownKeys:rt,preventExtensions:nt,set:de,setPrototypeOf:it,accessorize:nr,unaccessorize:ir,proxy:sr,unproxy:E,observe:Qe,unobserve:Ke,intercept:or,unintercept:ar,closure:fr,build:J,link:X,unlink:Z,Observers:S,Interceptors:T};var{URL:ur,fetch:cr,Headers:Ot,Request:lr,Response:pr,FormData:hr,ReadableStream:gn,File:Cd,Blob:St}=globalThis;var _n=t=>{let e=class extends t{constructor(...r){super(...r);var n=ne(this.search);let i=s=>{var o=qe(s);o=o?"?"+o:"",o!==this.search&&(this.search=o)};this.__query={value:n,proxy:new Proxy(n,{set(s,o,a){return s[o]=a,i(s),!0},deleteProperty(s,o){return delete s[o],i(s),!0}})}}set search(r){super.search=r;var n=ne(r);Pt(n,this.query)||(this.query=n)}get search(){return super.search}get query(){return this.__query.proxy}};return e.Observable=class extends e{constructor(){super(...arguments);let{Observer:r}=WebQit;r.accessorize(this,["protocol","username","password","host","hostname","port","origin","pathname","search","query","hash","href"])}},e},Pt=(t,e)=>d(t)&&d(e)?Pt(Object.keys(t),Object.keys(e))&&Pt(Object.values(t),Object.values(e)):m(t)&&m(e)?t.length===e.length&&t.reduce((r,n,i)=>r&&n===e[i],!0):t===e,mr=_n;var xn=t=>class extends t{tee(e=null){let r=new this.constructor,n=new this.constructor;for(var[i,s]of this.entries()){let o=o(s);e&&e(s,i,o)||!e&&!o?r.append(i,s):n.append(i,s)}return[r,n]}json(e={},r=null){if(arguments.length){Object.keys(e).forEach(o=>{We(o,e[o],(a,f)=>{(!r||r(a,f,g(f)))&&this.append(a,f)},a=>!Et(a))});return}var n;for(var[i,s]of this.entries())n||(n=O(ue(i,"["))?[]:{}),Me(n,i,s);return n}},dr=xn,Et=(t,e=null)=>{if(!g(t))return;let r=t[Symbol.toStringTag];return(e||["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer","Blob","File","FormData","Stream"]).reduce((n,i)=>n||(r===i?i:null),null)};var wn=t=>class extends t{constructor(e={}){let r=e.cookies;delete e.cookies,e instanceof t?super(e):(super(),this.json(e)),this.cookies=r}set(e,r){return this.catchCookies(e,r),super.set(e,r)}append(e,r){return this.catchCookies(e,r,!0),super.append(e,r)}delete(e){return this.catchCookies(e),super.delete(e)}set cookies(e){if(e instanceof Map){this.cookies.clear();for(let[r,n]of e)this.cookies.set(r,n)}else e&&this.set(this.cookieHeaderName,e);return!0}get cookies(){return this._cookies||(this._cookies=new this.Cookies,Object.defineProperty(this._cookies,"headers",{value:this})),this._cookies}catchCookies(e,r,n=!1){if(!(!this.cookies||e.toLowerCase()!==this.cookieHeaderName.toLowerCase())){if(this.cookies.outLock=!0,arguments.length>1){n||this.cookies.clear();let i=this.cookies.parse(r);for(let s in i)this.cookies.set(s,i[s])}else this.cookies.clear();this.cookies.outLock=!1}}json(e={},r=!0){if(arguments.length){let o=Ct(this),a=Object.keys(o).reduce((f,u)=>f.concat(typeof u!="symbol"&&"set"in o[u]?u:[]),[]);Object.keys(e).forEach(f=>{var u=a.reduce((c,l)=>c||(l===f||l.toLocaleLowerCase()===f?l:null),null);u?(r||this[u]===void 0)&&(this[u]=e[f]):(r||!this.has(f))&&this.set(f,e[f])});return}let n={};for(var[i,s]of this)n[i]=s;return n}set cacheControl(e){return this.set("Cache-Control",e)}get cacheControl(){return this.get("Cache-Control")}set contentLength(e){return this.set("Content-Length",e)}get contentLength(){return this.get("Content-Length")}set contentType(e){return this.set("Content-Type",e)}get contentType(){return this.get("Content-Type")}static compat(e){if(!(e instanceof this)&&!e.json){let r=Ct(new this);Object.keys(r).forEach(n=>{typeof n=="symbol"||n in e||Object.defineProperty(e,n,r[n])})}return e}},st=wn;function Ct(t){if(t){let e=Object.getPrototypeOf(t);return e===Object.prototype?{}:{...Ct(e),...Object.getOwnPropertyDescriptors(t)}}else return Object.create(null)}var ae=class extends Map{constructor(...e){super(...e),Object.defineProperty(this,"inLock",{value:!1,writable:!0}),Object.defineProperty(this,"outLock",{value:!1,writable:!0})}set(e,r){if(this.inLock)return;this.has(e)&&this.delete(e),this.inLock=!0;let n=r,i=r,s;return j(r)&&(n=this.parseEntry(`=${r}`)[1]),s=super.set(e,n),this.outLock||(d(r)&&(i=this.stringifyEntry(r)),gr(this.headers,`${e}=${i}`)),this.inLock=!1,s}delete(e){if(this.inLock)return;this.inLock=!0;let r=super.delete(e);this.headers.delete(this.headers.cookieHeaderName);for(let[n,i]of this)gr(this.headers,`${n}=${this.stringifyEntry(i)}`);return this.inLock=!1,r}clear(){if(this.inLock)return;this.inLock=!0;let e=super.clear();return this.headers.delete(this.headers.cookieHeaderName),this.inLock=!1,e}json(e={}){if(arguments.length){this.clear();for(let r in e)this.set(r,e[r]);return}for(let[r,n]of this)e[r]=n;return e}toString(){return this.headers.get(this.headers.cookieHeaderName)}};function gr(t,e){let r=[e],n=t.get(t.cookieHeaderName);n&&r.unshift(n),t.set(t.cookieHeaderName,r.join(t.cookieHeaderSeparator))}var Rt=class extends ae{parse(e){return ne(e,{},";")}parseEntry(e){return e.trim().split("=")}stringifyEntry(e){return e}},bn=t=>class extends st(t){get cookieHeaderName(){return"Cookie"}get cookieHeaderSeparator(){return";"}get Cookies(){return Rt}set accept(e){return this.set("Accept",e)}get accept(){let e=this.get("Accept"),r=e&&e.split(",").map(n=>(n=n.trim().split(";").map(i=>i.trim()),[n.shift(),parseFloat((n.pop()||"1").replace("q=",""))])).sort((n,i)=>n[1]>i[1]?-1:1)||[];return{match(n){return n=(n+"").split("/"),r.reduce((i,s)=>i||(s=s[0].split("/"))&&[0,1].every(o=>n[o]===s[o]||n[o]==="*"||s[o]==="*"),!1)},toString(){return e}}}set range(e){let r=[];return _(e).forEach((n,i)=>{let s=Array.isArray(n)?n.join("-"):n+"";i===0&&!s.includes("bytes=")&&(s=`bytes=${s}`),r.push(s)}),this.set("Range",r.join(", "))}get range(){let e=this.get("Range");return e?z(e,"bytes=").split(",").map(n=>{let i=n.trim().split("-");return i[0]=i[0]?parseInt(i[0],10):void 0,i[1]&&(i[1]=parseInt(i[1],10)),i.clamp=s=>{(i[1]>s-1||i[1]===void 0)&&(i[1]=s-1),i[0]===void 0&&(i[0]=i[1]?s-i[1]-1:0)},i}):void 0}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}},yr=bn;var At=class extends ae{parse(e){let r={};return e&&e.split(",").forEach(n=>{let[i,s]=this.parseEntry(n);r[i]=s}),r}parseEntry(e){let[r,n]=e.split(";"),[i,s]=r.trim().split("="),o={value:s};return n&&(n||"").split(/\;/g).map(a=>a.trim().split("=")).forEach(a=>{o[a[0][0].toLowerCase()+a[0].substring(1).replace("-","")]=a.length===1?!0:a[1]}),[i,o]}stringifyEntry(e){if(d(e)){let r=[e.value];for(let n in e){if(n==="value")continue;let i=n[0].toUpperCase()+n.substring(1);i==="MaxAge"&&(i="Max-Age"),r.push(e[n]===!0?i:`${i}=${e[n]}`)}e=r.join(";")}return e}},vn=t=>class extends st(t){get cookieHeaderName(){return"Set-Cookie"}get cookieHeaderSeparator(){return","}get Cookies(){return At}set contentRange(e){if(Array.isArray(e)){if(e.length===2&&!e[0].includes("-")||e.length<2)throw new Error("A Content-Range array must be in the format: [ 'start-end', 'total' ]");return this.set("Content-Range",`bytes ${e.join("/")}`)}return this.set("Content-Range",e)}get contentRange(){let e=this.get("Content-Range");return e&&z(e,"bytes ").split("/")}set cors(e){return this.set("Access-Control-Allow-Origin",e===!0?"*":e===!1?"":e)}get cors(){return this.get("Access-Control-Allow-Origin")}set attachment(e){if(e=e===!0?"attachment":e===!1?"inline":e,!j(e))throw new Error(`The "download" response directive does not support the type: ${C(e)}`);return["attachment","inline"].includes(e)||(e=`attachment; filename="${e}"`),this.set("Content-Disposition",e)}get attachment(){var e=(this.get("Content-Disposition")||"").trim();return e=e==="attachment"?!0:e==="inline"?!1:z(re(e,'"'),'filename="'),e}get location(){return this.get("Location")}set location(e){return this.set("Location",e)}},_r=vn;var On=(t,e,r)=>{let n=class extends t{constructor(i,s,o){s.headers&&(s={...s,headers:new e(s.headers)}),super(i,s),o.headers&&this.headers.json(o.headers);let a={};Object.defineProperty(this,"attrs",{get:()=>a}),Object.defineProperty(this,"bodyAttrs",{get:()=>o})}clone(){return new this.constructor(super.clone())}get headers(){return e.compat(super.headers),super.headers}get attrs(){return this.attrs}get url(){return"url"in this.attrs?this.attrs.url:super.url}async arrayBuffer(){return this.bodyAttrs.arrayBuffer?this.bodyAttrs.arrayBuffer:super.arrayBuffer()}async blob(){return this.bodyAttrs.blob?this.bodyAttrs.blob:super.blob()}async formData(){if(this.bodyAttrs.formData)return this.bodyAttrs.formData;let i=await super.formData();return i.tee=r.prototype.tee.bind(i),i.json=r.prototype.json.bind(i),i}async json(){return this.bodyAttrs.json?this.bodyAttrs.json:super.json()}async text(){return this.bodyAttrs.text?this.bodyAttrs.text:super.text()}jsonfy(i=!1){return(!this.bodyAttrs.jsonfied||i)&&(this.bodyAttrs.jsonfied=new Promise(async(s,o)=>{var a=this,f,u=a.headers.get("content-type")||"",c=u==="application/json"||this.bodyAttrs.json?"json":u==="application/x-www-form-urlencoded"||u.startsWith("multipart/form-data")||this.bodyAttrs.formData?"formData":u==="text/plain"?"plain":"other";try{c==="formData"?f=(await a.formData()).json():f=c==="json"?await a.json():c==="plain"?await a.text():a.body,s(f)}catch(l){o(l)}})),this.bodyAttrs.jsonfied}};return n.Headers=e,n},ot=On;function at(t,e,r){let n={body:t,input:t},i=(a,f)=>{if(e.encode){let[u,c]=e.encode(f);a.body=u,a.headers=c;return}a.body=f};if(j(t)||q(t))return n.inputType="text",n.text=t,n.headers={contentLength:(t+"").length},n;if(n.inputType=Et(t),["Blob","File"].includes(n.inputType))n.blob=t,n.headers={contentType:t.type,contentLength:t.size};else if(["Uint8Array","Uint16Array","Uint32Array","ArrayBuffer"].includes(n.inputType))n.arrayBuffer=t,n.headers={contentLength:t.byteLength};else if(n.inputType==="FormData")n.formData=t,i(n,t);else if(d(t)&&Ue(t)||m(t)&&lt(t)){n.inputType="object";var s,o=new e;o.json(t,(a,f,u)=>(s=s||u,!0)),s?(n.formData=o,i(n,o)):(n.json=t,n.body=JSON.stringify(t),n.headers={contentType:"application/json",contentLength:new r([n.body]).size}),n.jsonfied=t}return n}var Sn=(t,e,r,n)=>class extends ot(t,e,r){constructor(i,s={}){s={...s};let o={};i instanceof t&&(s.method&&i.method!==s.method.toUpperCase()&&["GET","HEAD"].includes(s.method.toUpperCase())?(i=i.url,["headers","mode","credentials","cache","redirect","referrer","integrity"].forEach(f=>{f in s||(s[f]=i[f])})):o=i.bodyAttrs||{}),"body"in s&&(o=at(s.body,r,n),s.body=o.body);let a;s.mode==="navigate"&&(a=!0,s={...s},delete s.mode),super(i,s,o),a&&(this.attrs.mode="navigate")}get mode(){return"mode"in this.attrs?this.attrs.mode:super.mode}get cache(){return"cache"in this.attrs?this.attrs.cache:super.cache}get destination(){return"destination"in this.attrs?this.attrs.destination:super.destination}get referrer(){return"referrer"in this.attrs?this.attrs.referrer:super.referrer}static async rip(i){let s=["method","headers","mode","credentials","cache","redirect","referrer","integrity"].reduce((o,a)=>({[a]:i[a],...o}),{});return["GET","HEAD"].includes(i.method)||(s.body=await i.text()),[i.url,s]}static compat(i){if(i instanceof this)return i;if(i instanceof t)return Object.setPrototypeOf(i,new this)}},xr=Sn;var Pn=(t,e,r,n)=>class extends ot(t,e,r){constructor(i=null,s={}){let o={},a;arguments.length&&(i instanceof t?(a=i,s={status:i.status,statusText:i.statusText,headers:i.headers,...s},i.status===0&&delete s.status,o=i.bodyAttrs||{},i=i.body):(o=at(i,r,n),i=o.body)),super(i,s,o),a&&(this.attrs.url=a.url,this.attrs.ok=a.ok,this.attrs.status=a.status,this.attrs.type=a.type,this.attrs.redirected=a.redirected)}get ok(){return"ok"in this.attrs?this.attrs.ok:super.ok}get status(){return"status"in this.attrs?this.attrs.status:super.status}get statusText(){return"statusText"in this.attrs?this.attrs.statusText:super.statusText}get type(){return"type"in this.attrs?this.attrs.type:super.type}get redirected(){return"redirected"in this.attrs?this.attrs.redirected:super.redirected}static compat(i){if(i instanceof this)return i;if(i instanceof t)return Object.setPrototypeOf(i,new this)}},wr=Pn;var En=(t,e)=>(r,n={})=>n.body&&typeof n.body=="object"?t(new e(r,n)):t(r,n),br=En;var Cn=(t,e,r)=>{let n=class{constructor(i,s,o){this._request=i,this._detail=s||{},this._sessionFactory=o,this.Request=t,this.Response=e,this.URL=r,this.port={listeners:[],post(a){let f=this.listeners.map(u=>u(a)).filter(u=>u instanceof Promise);if(process.length)return Promise.all(f)},listen(a){this.listeners.push(a)}}}get url(){return this._url||(this._url=new this.URL(this._request.url)),this._url}get request(){return this._request}get detail(){return this._detail}get session(){return this._session||(this._session=this.sessionFactory().get()),this._session}sessionFactory(...i){return this._sessionFactory(...i)}redirect(i,s=302){return new this.Response(null,{status:s,headers:{Location:i}})}with(i,s={},o=null){let a;return i instanceof t?(fe(s)?a=i:a=new t(i,s),o&&(a.attrs.url=`${this.url.origin}${o}`)):(a=new t(this._request,s),a.attrs.url=`${this.url.origin}${i}`,a.attrs.referrer=this.request.url),new n(a,this.detail)}};return n},vr=Cn;var ge=class{constructor(e,r){if(this.cx=e,this.cx.runtime=this,this.client=y(r)?r(this.cx):r,!this.client||!this.client.handle)throw new Error('Application instance must define a ".handle()" method.')}};var Or=mr(ur),jt=dr(hr);var Sr=yr(Ot),Pr=_r(Ot),ye=xr(lr,Sr,jt,St),_e=wr(pr,Pr,jt,St),ft=br(cr,ye),ut=vr(ye,_e,Or);var Ie=class{constructor(){this.messaging={post:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return r.postMessage(e),this.post},listen:(e,r=this.client)=>r?(r.addEventListener("message",e),this.post):(self.addEventListener("message",n=>{this.client=n.source;let i=e(n),s=n.ports[0];s&&(i instanceof Promise?i.then(o=>{s.postMessage(o)}):s.postMessage(i))}),this.post),request:(e,r=this.client)=>{if(!r)throw new Error("No client for this operation.");return new Promise(n=>{let i=new MessageChannel;r.postMessage(e,[i.port2]),i.port1.onmessage=s=>n(s.data)})},channel(e){this.channels.has(e)||this.channels.set(e,new BroadcastChannel(r));let r=this.channels.get(e);return{broadcast:n=>r.postMessage(n),listen:n=>r.addEventListener("message",n)}},channels:new Map},this.notifications={fire:(e,r={})=>new Promise((n,i)=>{if(!(self.Notification&&self.Notification.permission==="granted"))return i(self.Notification&&self.Notification.permission);s.addEventListener("error",i);let s=new self.Notification(e,r);s.addEventListener("click",n),s.addEventListener("close",n)}),handle:e=>(self.addEventListener("notificationclick",e),this.notifications)},this.push={listen:e=>(self.addEventListener("push",e),this.post)}}setCurrentClient(e){this.client=e}};var Ne=class extends ge{constructor(e,r){super(e,r),this.mockSessionStore={},self.addEventListener("install",i=>{this.cx.params.skip_waiting&&self.skipWaiting(),this.cx.params.cache_name&&(this.cx.params.cache_only_urls||[]).length&&i.waitUntil(self.caches.open(this.cx.params.cache_name).then(s=>{this.cx.logger&&this.cx.logger.log("[ServiceWorker] Pre-caching resources.");let o=(this.cx.params.cache_only_urls||[]).map(a=>a.trim()).filter(a=>a&&!_t(a,self.origin).isPattern());return s.addAll(o)}))}),self.addEventListener("activate",i=>{i.waitUntil(new Promise(async s=>{this.cx.params.skip_waiting&&await self.clients.claim(),this.cx.params.cache_name&&await self.caches.keys().then(o=>Promise.all(o.map(a=>{if(a!==this.cx.params.cache_name&&a!==this.cx.params.cache_name+"_json")return this.cx.logger&&this.cx.logger.log("[ServiceWorker] Removing old cache:",a),self.caches.delete(a)}))),s()}))}),P.set(this,"location",{}),P.set(this,"network",{}),P.observe(this.network,i=>{}),self.addEventListener("fetch",i=>{!i.request.url.startsWith("http")||i.respondWith((async(s,o)=>{let a=await self.clients.get(i.clientId);this.workport.setCurrentClient(a);let[f,u]=await ye.rip(s);return s.cache==="force-cache"&&(u.cache="default"),this.go(f,u,{event:o})})(i.request,i))});let n=new Ie;P.set(this,"workport",n),(async()=>{if(!this.client.init)return;let i=this.generateRequest("/"),s=new ut(i,{srcType:"initialization"},(o=null,a=!1)=>this.getSession(s,o,a));await this.client.init(s,(...o)=>this.remoteFetch(...o))})()}async go(e,r={},n={}){e=typeof e=="string"?new URL(e):e,r={referrer:this.location.href,...r};let i=await this.generateRequest(e.href,r);n.event&&Object.defineProperty(n.event,"request",{value:i});let s=new ut(i,n,(f=null,u=!1)=>this.getSession(s,f,u));s.port.listen(f=>{if(f.$type==="handler:hints"&&f.session)return Promise.resolve()});let o;return s.request.url.startsWith(self.origin)?o=await this.client.handle(s,(...f)=>this.remoteFetch(...f)):o=await this.remoteFetch(s.request),this.handleResponse(s,o)}generateRequest(e,r={}){return new ye(e,r)}getSession(e,r=null,n=!1){return{get:()=>this.mockSessionStore,set:i=>{this.mockSessionStore=i}}}remoteFetch(e,...r){arguments.length>1&&(e=this.generateRequest(e,...r));let n=(o,a)=>Se((o||[]).map(f=>f.trim()).filter(f=>f),f=>_t(f,self.origin).test(a)),s=(()=>{if(!this.cx.params.default_fetching_strategy||this.cx.params.default_fetching_strategy==="network-first"||n(this.cx.params.network_first_urls,e.url))return P.set(this.network,"strategy","network-first"),this.networkFetch(e,{cacheFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="cache-first"||n(this.cx.params.cache_first_urls,e.url))return P.set(this.network,"strategy","cache-first"),this.cacheFetch(e,{networkFallback:!0,cacheRefresh:!0});if(this.cx.params.default_fetching_strategy==="network-only"||n(this.cx.params.network_only_urls,e.url))return P.set(this.network,"strategy","network-only"),this.networkFetch(e,{cacheFallback:!1,cacheRefresh:!1});if(this.cx.params.default_fetching_strategy==="cache-only"||n(this.cx.params.cache_only_urls,e.url))return P.set(this.network,"strategy","cache-only"),this.cacheFetch(e,{networkFallback:!1,cacheRefresh:!1})})(e);return s.catch(o=>P.set(this.network,"error",o.message)),s.then(o=>_e.compat(o))}networkFetch(e,r={}){return r.cacheFallback?ft(e).then(n=>(r.cacheRefresh&&this.refreshCache(e,n),P.set(this.network,"remote",!0),n)).catch(()=>this.getRequestCache(e).then(n=>(P.set(this.network,"cache",!0),n.match(e)))):(P.set(this.network,"remote",!0),ft(e))}cacheFetch(e,r={}){return this.getRequestCache(e).then(n=>n.match(e).then(i=>!i&&r.networkFallback?this.networkFetch(e,{...r,cacheFallback:!1}):(i&&r.cacheRefresh&&this.networkFetch(e,{...r,justRefreshing:!0}),P.set(this.network,"cache",!0),i)))}refreshCache(e,r){if(e.method!=="GET"||!r||r.status!==200||r.type!=="basic"&&r.type!=="cors")return r;var n=r.clone();return this.getRequestCache(e).then(i=>{P.set(this.network,"cacheRefresh",!0),i.put(e,n)}),r}getRequestCache(e){let r=e.headers.get("Accept")==="application/json"?this.cx.params.cache_name+"_json":this.cx.params.cache_name;return self.caches.open(r)}handleResponse(e,r){return r instanceof _e||(r=_e.compat(r)),r}};async function Er(t=null){let e=this||{},r=n=>new ke(n);return new Ne(be.create(e),t||r)}var An={},jn={cache_name:"cache_v0",default_fetching_strategy:"network-first",network_first_urls:[],cache_first_urls:[],network_only_urls:[],cache_only_urls:[],skip_waiting:!1,support_push:!1,push_registration_url:"",push_deregistration_url:"",push_public_key:"",routing:{root:"/",subroots:[],targets:5}};Er.call({layout:An,params:jn});
})();
